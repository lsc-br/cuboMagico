Ibles.package("Ibles.mixins"),Ibles.mixins.SelectOneCollection={getSelected:function(){return this.findWhere({selected:!0})},select:function(e){this.forEach((function(e){e.set({selected:!1},{silent:!0})})),e.set({selected:!0})},deselect:function(e){e.set({selected:!1})}},Ibles.mixins.SelectManyCollection={getSelected:function(){return this.where({selected:!0})},select:function(e){e.set({selected:!0})},deselect:function(e){e.set({selected:!1})},deselectAll:function(){this.invoke("set",{selected:!1})},selectOnly:function(e,t){this.deselectAll(),this.forEach((function(n){_.contains(t,n.get(e))&&n.set({selected:!0})}))}},Ibles.mixins.SelectableModel={mergedAttributes:{selected:!1},select:function(e){return this.collection.select(this,e),this},deselect:function(e){return this.collection.deselect(this,e),this},toggleSelected:function(e){return this.get("selected")?this.deselect(e):this.select(e),this}},Ibles.package("Ibles.models"),Ibles.models.ChannelModel=Backbone.Model.extend({idAttribute:"name",defaults:{name:null,title:null,type:null,category:null,following:!1},toggleFollowing:function(){var e=this,t=_.extend(this.getFollowedParams(),{following:!this.get("following")});return Ibles.API.post({url:Ibles.apiUrl("setFollowing"),data:$.param(t,!0),processData:!1,success:function(t){e.set({following:t.following})}})},getFollowedParams:function(){var e={};return Ibles.setFollowChannelParams(e,this.get("category"),this.get("name")),e},isFollowing:function(){var e=this,t=this.getFollowedParams();return Ibles.API.getRequest("isFollowing",t,{success:function(t){e.set({following:t.isFollowing})}})}}),Ibles.package("Ibles.collections"),Ibles.collections.ChannelCollection=Backbone.Collection.extend({initialize:function(){this.makeMultiSelectable()},makeMultiSelectable:function(){Ibles.applyMixin(this,Ibles.mixins.SelectManyCollection)},model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.ChannelModel(e,t))},modelId:function(e){return e.name},getChannel:function(e){return this.get(e)}}),Ibles.package("Ibles.models"),Ibles.models.CategoryModel=Backbone.Model.extend({idAttribute:"name",defaults:function(){return{name:null,title:null,type:null,channels:[]}},initialize:function(e){var t=e||{};this.channelsCollection=new Ibles.collections.ChannelCollection(t.channels||[],{parse:!0})},getDisplayTitle:function(){return this.get("title")}}),Ibles.package("Ibles.models"),Ibles.models.TeacherCategoryModel=Ibles.models.CategoryModel.fullExtend({defaults:function(){return{name:null,title:null,type:null,channels:[],grades:[],gradeGroups:[],subjects:[]}},initialize:function(e,t){var n=e||{},i=n.grades||[],s=n.gradeGroups||[],o=n.subjects||[],a=i.concat(o);this._super(_.extend(n,{channels:a}),t),this.gradesCollection=new Ibles.collections.GradeCollection(i,{parse:!0}),this.gradeGroupsCollection=new Ibles.collections.GradeGroupCollection(s,{parse:!0}),this.subjectsCollection=new Ibles.collections.SubjectCollection(o,{parse:!0})},reset:function(e){var t=e||{};this.gradesCollection.reset(t.grades||[]),this.gradeGroupsCollection.reset(t.gradeGroups||[]),this.subjectsCollection.reset(t.subjects||[]),this.channelsCollection.reset((t.grades||[]).concat(t.subjects||[])),this.set({name:t.name,title:t.title,type:t.type})}}),Ibles.package("Ibles.collections"),Ibles.collections.CategoryCollection=Backbone.Collection.extend({initialize:function(){Ibles.applyMixin(this,Ibles.mixins.SelectOneCollection)},model:function(e,t){var n;return n="teachers"===e.name?new Ibles.models.TeacherCategoryModel(e,t):new Ibles.models.CategoryModel(e,t),Ibles.applyMixin(n,Ibles.mixins.SelectableModel),n},modelId:function(e){return e.name},getCategoryModel:function(e){return this.get(e)},getChannelsInCategory:function(e){var t=this.getCategoryModel(e);return t&&t.channelsCollection}}),Ibles.package("Ibles.models"),Ibles.models.SubjectModel=Ibles.models.ChannelModel.fullExtend({defaults:function(){return{type:"subject",category:"teachers"}}}),Ibles.package("Ibles.collections"),Ibles.collections.SubjectCollection=Ibles.collections.ChannelCollection.extend({model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.SubjectModel(e,t))},getSelectedSubjectNames:function(){var e=this.getSelected();return _.map(e,(function(e){return e.get("name")}))},getSelectedSubjectTitles:function(){var e=this.getSelected();return _.map(e,(function(e){return e.get("title")}))}}),Ibles.package("Ibles.models"),Ibles.models.GradeModel=Ibles.models.ChannelModel.fullExtend({defaults:function(){return{type:"grade",category:"teachers",gradeGroup:null}}}),Ibles.package("Ibles.collections"),Ibles.collections.GradeCollection=Ibles.collections.ChannelCollection.extend({model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.GradeModel(e,t))},getSelectedGradeGroupNames:function(){var e=this.getSelected(),t=_.map(e,(function(e){return e.get("gradeGroup")}));return _.uniq(t)}}),Ibles.package("Ibles.models"),Ibles.models.GradeGroupModel=Ibles.models.ChannelModel.fullExtend({defaults:function(){return{name:"",title:"",type:"gradeGroup",category:"teachers",grades:[]}},getFollowedParams:function(){return{grade:this.get("grades")}}}),Ibles.package("Ibles.collections"),Ibles.collections.GradeGroupCollection=Ibles.collections.ChannelCollection.extend({model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.GradeGroupModel(e,t))},initialize:function(e){if(this._super(e),!e){var t=Ibles.pageContext.gradeGroups;_.isEmpty(t)||this.reset(Ibles.pageContext.gradeGroups);var n=Ibles.pageContext.taxonomy,i=n&&_.findWhere(n,{name:"teachers"});_.isEmpty(i)||_.isEmpty(i.gradeGroups)||this.reset(i.gradeGroups)}},getGradeGroupContainingGrade:function(e){return this.find((function(t){return _.contains(t.get("grades"),e)}))},getSelectedNames:function(){return _.map(this.getSelected(),(function(e){return e.get("title")}))},getSelectedGrades:function(){var e=[];return _.each(this.getSelected(),(function(t){e=e.concat(t.get("grades"))})),e}}),Ibles.package("Ibles.models"),Ibles.models.Taxonomy=Backbone.Model.fullExtend({initialize:function(){this.categoryCollection=new Ibles.collections.CategoryCollection(Ibles.pageContext.taxonomy||[]),this.originalData=[]},clone:function(){var e=new Ibles.models.Taxonomy;return e.categoryCollection.reset(this.originalData,{parse:!0}),e},fetch:function(){var e=this;return this.fetchPromise().done((function(t){e.originalData=t,e.categoryCollection.reset(t,{parse:!0}),e.trigger("taxonomyLoaded")}))},fetchPromise:function(){return Ibles.taxonomyPromise||(Ibles.taxonomyPromise=Ibles.API.get({url:Ibles.reverseUrls.getTaxonomyUrl()})),Ibles.taxonomyPromise},getChannelsInCategory:function(e){return this.categoryCollection.getChannelsInCategory(e)},getChannelInCategory:function(e,t){var n=this.getChannelsInCategory(e);return n&&n.getChannel(t)},hasChannelInCategory:function(e,t){return!!this.getChannelInCategory(e,t)},getCategory:function(e){return this.categoryCollection.get(e)},getTeachersCategory:function(){return this.categoryCollection.get("teachers")},getSubjectsCollection:function(){return this.getTeachersCategory().subjectsCollection},getSubject:function(e){return this.getSubjectsCollection().get(e)},getGradesCollection:function(){return this.getTeachersCategory().gradesCollection},getGrade:function(e){return this.getGradesCollection().get(e)},getGradeGroupForGrade:function(e){return this.getTeachersCategory().gradeGroupsCollection.find((function(t){return _.contains(t.get("grades"),e)}))},toFlatBrowsableChannelsList:function(){var e=[];return this.categoryCollection.each((function(t){"teachers"===t.get("name")?(e.push.apply(e,t.get("gradeGroups")),e.push.apply(e,_.filter(t.get("channels"),(function(e){return"subject"===e.type})))):e.push.apply(e,t.get("channels"))})),e}}),Ibles.package("Ibles.models"),Ibles.models.Classifier=Backbone.Model.extend({defaults:{classifiable:null,updatePrimary:!0},save:function(){var e=this,t=this.getParams(e.get("classifiable"));return this.trigger("status",{name:"loading"}),Ibles.API.jsonPostRequest("setClassifications",t).done((function(){e.trigger("status",{name:"success"})})).fail((function(){e.trigger("status",{name:"error"})}))},getParams:function(e){var t=this.get("updatePrimary"),n={id:e.get("id"),type:this.getTypeParam(e)};return Ibles.setClassificationsPostParam(e,n,t),n},getTypeParam:function(e){var t=e.get("type");return"Guide"==t?"collection":"Step by Step"==t?"project":"topic"}}),Ibles.package("Ibles.models","Ibles.collections"),Ibles.models.MemberModel=Backbone.Model.extend({defaults:function(){return{id:null,screenName:null,downloadUrl:null,following:!1,views:0,commentCount:0,discussionCount:0,featuredCount:0,favoritesCount:0,instructablesCount:0,draftsCount:0,publishedCollectionsCount:0,publishedProjectCount:0,draftCollectionsCount:0,collaborationsCount:0,followersCount:0,subscriptionsCount:0,occupations:[],images:[],socialHandles:[],website:{}}},initialize:function(e,t){t=t||{},this.userDataFetched=!1,this.profileImageCollection=new Ibles.collections.FileCollection(this.get("images")),t.fetchAuthorStats&&this.fetchAuthorStats(),t.fetchUserData&&this.fetchUserData()},getUrl:function(){return Ibles.reverseUrls.memberUrl(this.get("screenName"))},getAvatarFile:function(){return Ibles.fileFromDict(this.attributes)},getProfileImageUrls:function(){return this.profileImageCollection.map((function(e){return e.getMediumUrl()}))},fetch:function(){var e=this;return Ibles.API.getRequest("showAuthorModel",{screenName:this.get("screenName")}).done((function(t){e.set(t)}))},fetchAuthorStats:function(){var e=this;Ibles.API.getRequest("showAuthorStats",{screenName:this.get("screenName")}).done((function(t){e.set(t)})).always((function(){e.trigger("authorStatsSynced")}))},fetchUserData:function(){var e=this;Ibles.session.authenticated()&&(Ibles.session.isAdmin()||Ibles.session.get("screenName")===this.get("screenName"))&&Ibles.API.getRequest("showAuthorUserData",{screenName:this.get("screenName"),cb:Date.now()}).done((function(t){e.set(t),e.profileImageCollection.reset(t.images||[])})).error((function(e,t){401===t.status&&Ibles.API.post({url:Ibles.reverseUrls.logoutProxyUrl(),success:function(){Ibles.session.clear(),Ibles.locationAssign(window.location.href)}})})).always((function(){e.trigger("userDataSynced"),e.userDataFetched=!0}))},toggleFollowing:function(){var e=this;return Ibles.API.postRequest("setFollowing",{memberId:this.get("id"),following:!this.get("following")},{success:function(t){e.set({following:t.following})}})},isFollowing:function(){var e=this;return Ibles.API.getRequest("isFollowing",{screenName:this.get("screenName"),cb:Date.now()},{success:function(t){e.set({following:t.isFollowing||!1})}})},purgeFromCache:function(){return Ibles.API.jsonPostRequest("purgeCaches",{ids:[this.get("id")]})},sendPrivateMessage:function(e,t,n){var i={posted:(new Date).getTime(),body:Ibles.paragraphize(t.replace(/<\/?[^>]+(>|$)/g,"")),subject:e.replace(/<\/?[^>]+(>|$)/g,""),recipientId:this.get("id")},s=this;return _.isEmpty(n)||(i.inReplyToId=n),Ibles.API.jsonPostRequest("privateMessage",i,{success:function(){s.trigger("privateMessageSent")},error:function(){s.trigger("privateMessageError")}})},updateProfile:function(e){var t=this;return Ibles.API.jsonPost(Ibles.URLS.updateProfileUrl(),e).done((function(){Ibles.session.resetForCurrentUser((function(){t.trigger("updateProfileSuccess")}))})).fail((function(){t.trigger("updateProfileError")}))},updateSettings:function(e){var t=e||{};return Ibles.API.post({url:Ibles.URLS.updateSettingsUrl(),data:t})}}),Ibles.collections.MemberCollection=Backbone.Collection.extend({model:Ibles.models.MemberModel}),Ibles.package("Ibles.models"),Ibles.models.BaseInstructableModel=Backbone.Model.extend({defaults:function(){return{id:null,title:null,urlString:null,fullUrl:null,author:null,type:null,status:null,classifications:[],suppliesFiles:[],category:null,channel:null,publishDate:null,favorite:!1,flagged:!1,fetchUserData:!1,fetchStats:!1,resourceType:null,collaborators:[],indexTags:[],submissions:[],totalProjects:0,coverImage:null}},initialize:function(e){this.author=new Ibles.models.MemberModel(this.get("author")),this.set({favorite:e&&e.favorite,isExceedingCollectionLimit:this.get("totalProjects")>Ibles.pageContext.collectionLimit}),this.get("fetchUserData")&&this.fetchUserData(),this.get("fetchStats")&&this.fetchStats()},fetch:function(){var e=this;return Ibles.API.getRequest("showInstructableModel",{id:this.get("id")}).done((function(t){e.set(e.parse(t)),t.author&&e.author.set(t.author)}))},parse:function(e){return Ibles.setPrimaryClassificationDetails(e),Ibles.deepExtend(Ibles.pageContext.ibleData,e),e},fetchUserData:function(){if(Ibles.session.authenticated()){var e=this;Ibles.API.getRequest("showInstructableUserData",{id:this.get("id"),rand:Math.round((new Date).getTime()/1e3)}).done((function(t){e.set(e.parse(t)),e.author.set({following:t.following})})).always((function(){e.trigger("userDataSynced")}))}},fetchStats:function(){var e=this;return Ibles.API.getRequest("getIbleStats",{id:this.get("id")},{success:function(t){e.set(t)}})},flagAction:function(){var e=this;return Ibles.API.ajaxRequest("flag/",{entryID:this.get("id"),action:"SET",flag:this.get("flaggedAs")},{success:function(){e.set({flagged:!0})}})},favoriteAction:function(){var e=this;return Ibles.API.ajaxRequest("favorite/",{entryId:this.get("id")},{success:function(){e.set({favorite:!e.get("favorite")})}})},isFavorite:function(){var e=this;return Ibles.API.getRequest("isFavorite",{id:this.get("id")},{success:function(t){e.set({favorite:t.isFavorite})}})},isOwner:function(e){return this.author.get("id")===e},currentUserIsOwner:function(){var e=Ibles.session;return e.authenticated()&&this.isOwner(e.get("id"))},isCollaborator:function(){var e=this.get("collaborators");return!_.isEmpty(e)&&!_.isEmpty(_.findWhere(e,{id:Ibles.session.get("id")}))},isEditableByCurrentUser:function(){var e=Ibles.session,t=e.get("id");return e.isAdmin()||this.isOwner(t)||this.isCollaborator(t)||e.canEditMakeyMakeyResource()||e.canSetIndexTags()||e.canEditKeywords()||e.canEditClassifications()},getNonInternalIndexTags:function(){return _.without(this.get("indexTags")||[],"internal")},toJSON:function(){var e=Backbone.Model.prototype.toJSON.apply(this,arguments);return e.url=Ibles.reverseUrls.ibleUrl(e.id),e},getPdfUrl:function(){return`/json-api/viewPdf?id=${this.get("id")}`},getEditUrl:function(){return"Guide"===this.get("type")?Ibles.reverseUrls.collectionEditUrl(this.get("id")):Ibles.reverseUrls.ibleEditUrl(this.get("id"))},getFiles:function(){var e=$.Deferred();return this.getFilesPromise||("Step by Step"!==this.get("type")?e.resolve([]):Ibles.API.getRequest("getFiles",{instructableId:this.get("id")},{success:function(t){var n=t.files.map((function(e){return new Ibles.collections.FileCollection(e||[])}));e.resolve(n)}}),this.getFilesPromise=e.promise()),this.getFilesPromise},getPhotosetFiles:function(){var e=$.Deferred();return this.getFiles().done((function(t){var n=[];_.each(t,(function(e){if(e.length){var t=e.filter((function(e){return e.get("image")}));t.length&&n.push(new Ibles.collections.FileCollection(t))}})),e.resolve(n)})),e.promise()}}),Ibles.package("Ibles.models"),Ibles.models.InstructableModel=Ibles.models.BaseInstructableModel.fullExtend({defaults:function(){return{disableComments:!1,allSteps:!1,currentStepIndex:0}},initialize:function(e,t){this._super(e,t),this.set({fullUrl:Ibles.pageContext.remoteHost+this.getUrl()})},getUrl:function(){var e=Ibles.reverseUrls;return"UNPUBLISHED"===this.get("status")?e.previewUrl(this.get("id")):e.ibleUrl(this.get("urlString")||this.get("id"))}}),Ibles.package("Ibles.collections"),Ibles.collections.InstructableCollection=Backbone.Collection.extend({model:Ibles.models.InstructableModel}),Ibles.package("Ibles.services"),Ibles.services.ImageRotationService=Backbone.Model.extend({rotateFileId:function(e,t){return Ibles.API.put({url:Ibles.apiUrl("file"),data:JSON.stringify({id:e,customRotation:t}),contentType:"application/json"})},rotateFileUrl:function(e,t){var n=e.split("/").pop().replace(/\..*/,"");return this.rotateFileId(n,t)}}),$.browser={version:8,msie:window.navigator.userAgent.indexOf("MSIE ")>0},
/*! fancyBox v2.0.5 fancyapps.com | fancyapps.com/fancybox/#license */
function(e,t,n){var i=n(e),s=n(t),o=n.fancybox=function(){o.open.apply(this,arguments)},a=!1,r=void 0!==t.createTouch;n.extend(o,{version:"2.0.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:!0,autoResize:!r,autoCenter:!r,fitToView:!0,aspectRatio:!1,topRatio:.5,fixed:!(n.browser.msie&&6>=n.browser.version||r),scrolling:"auto",wrapCSS:"fancybox-default",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},keys:{next:[13,32,34,39,40],prev:[8,33,37,38],close:[27]},tpl:{wrap:'<div class="fancybox-wrap"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0"'+(n.browser.msie?' allowtransparency="true"':"")+"></iframe>",swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="Close" class="fancybox-item fancybox-close"></div>',next:'<a title="Next" class="fancybox-nav fancybox-next"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:300,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:300,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:.8,css:{cursor:"pointer"},closeClick:!0},title:{type:"float"}}},group:{},opts:{},coming:null,current:null,isOpen:!1,isOpened:!1,wrap:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(e,t){o.close(!0),e&&!n.isArray(e)&&(e=e instanceof n?n(e).get():[e]),o.isActive=!0,o.opts=n.extend(!0,{},o.defaults,t),n.isPlainObject(t)&&void 0!==t.keys&&(o.opts.keys=!!t.keys&&n.extend({},o.defaults.keys,t.keys)),o.group=e,o._start(o.opts.index||0)},cancel:function(){o.coming&&!1===o.trigger("onCancel")||(o.coming=null,o.hideLoading(),o.ajaxLoad&&o.ajaxLoad.abort(),o.ajaxLoad=null,o.imgPreload&&(o.imgPreload.onload=o.imgPreload.onabort=o.imgPreload.onerror=null))},close:function(e){o.cancel(),o.current&&!1!==o.trigger("beforeClose")&&(o.unbindEvents(),!o.isOpen||e&&!0===e[0]?(n(".fancybox-wrap").stop().trigger("onReset").remove(),o._afterZoomOut()):(o.isOpen=o.isOpened=!1,n(".fancybox-item, .fancybox-nav").remove(),o.wrap.stop(!0).removeClass("fancybox-opened"),o.inner.css("overflow","hidden"),o.transitions[o.current.closeMethod]()))},play:function(e){var t=function(){clearTimeout(o.player.timer)},i=function(){t(),o.current&&o.player.isActive&&(o.player.timer=setTimeout(o.next,o.current.playSpeed))},s=function(){t(),n("body").unbind(".player"),o.player.isActive=!1,o.trigger("onPlayEnd")};o.player.isActive||e&&!1===e[0]?s():o.current&&(o.current.loop||o.current.index<o.group.length-1)&&(o.player.isActive=!0,n("body").bind({"afterShow.player onUpdate.player":i,"onCancel.player beforeClose.player":s,"beforeLoad.player":t}),i(),o.trigger("onPlayStart"))},next:function(){o.current&&o.jumpto(o.current.index+1)},prev:function(){o.current&&o.jumpto(o.current.index-1)},jumpto:function(e){o.current&&(e=parseInt(e,10),1<o.group.length&&o.current.loop&&(e>=o.group.length?e=0:0>e&&(e=o.group.length-1)),void 0!==o.group[e]&&(o.cancel(),o._start(e)))},reposition:function(e){o.isOpen&&o.wrap.css(o._getPosition(e))},update:function(e){o.isOpen&&(a||setTimeout((function(){var t=o.current;a&&(a=!1,t)&&((t.autoResize||e&&"orientationchange"===e.type)&&(t.autoSize&&(o.inner.height("auto"),t.height=o.inner.height()),o._setDimension(),t.canGrow&&o.inner.height("auto")),t.autoCenter&&o.reposition(),o.trigger("onUpdate"))}),100),a=!0)},toggle:function(){o.isOpen&&(o.current.fitToView=!o.current.fitToView,o.update())},hideLoading:function(){n("#fancybox-loading").remove()},showLoading:function(){o.hideLoading(),n('<div id="fancybox-loading"><div></div></div>').click(o.cancel).appendTo("body")},getViewport:function(){return{x:i.scrollLeft(),y:i.scrollTop(),w:i.width(),h:i.height()}},unbindEvents:function(){o.wrap&&o.wrap.unbind(".fb"),s.unbind(".fb"),i.unbind(".fb")},bindEvents:function(){var e=o.current,t=e.keys;e&&(i.bind("resize.fb, orientationchange.fb",o.update),t&&s.bind("keydown.fb",(function(e){var i;!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!e.metaKey&&0>n.inArray(e.target.tagName.toLowerCase(),["input","textarea","select","button"])&&(i=e.keyCode,-1<n.inArray(i,t.close)?(o.close(),e.preventDefault()):-1<n.inArray(i,t.next)?(o.next(),e.preventDefault()):-1<n.inArray(i,t.prev)&&(o.prev(),e.preventDefault()))})),n.fn.mousewheel&&e.mouseWheel&&1<o.group.length&&o.wrap.bind("mousewheel.fb",(function(e,t){var i=n(e.target).get(0);(0===i.clientHeight||i.scrollHeight===i.clientHeight&&i.scrollWidth===i.clientWidth)&&(e.preventDefault(),o[0<t?"prev":"next"]())})))},trigger:function(e){var t,i=o[-1<n.inArray(e,["onCancel","beforeLoad","afterLoad"])?"coming":"current"];if(i){if(n.isFunction(i[e])&&(t=i[e].apply(i,Array.prototype.slice.call(arguments,1))),!1===t)return!1;i.helpers&&n.each(i.helpers,(function(t,s){s&&void 0!==o.helpers[t]&&n.isFunction(o.helpers[t][e])&&o.helpers[t][e](s,i)})),n.event.trigger(e+".fb")}},isImage:function(e){return e&&e.match(/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i)},isSWF:function(e){return e&&e.match(/\.(swf)(.*)?$/i)},_start:function(e){var t,i,s,a={},r=o.group[e]||null;r&&(r.nodeType||r instanceof n)&&(t=!0,n.metadata&&(a=n(r).metadata())),a=n.extend(!0,{},o.opts,{index:e,element:r},n.isPlainObject(r)?r:a),n.each(["href","title","content","type"],(function(e,i){a[i]=o.opts[i]||t&&n(r).attr(i)||a[i]||null})),"number"==typeof a.margin&&(a.margin=[a.margin,a.margin,a.margin,a.margin]),a.modal&&n.extend(!0,a,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{css:{cursor:"auto"},closeClick:!1}}}),o.coming=a,!1===o.trigger("beforeLoad")?o.coming=null:(i=a.type,e=a.href||r,i||(t&&(!(s=n(r).data("fancybox-type"))&&r.className&&(i=(s=r.className.match(/fancybox\.(\w+)/))?s[1]:null)),!i&&"string"===n.type(e)&&(o.isImage(e)?i="image":o.isSWF(e)?i="swf":e.match(/^#/)&&(i="inline")),i||(i=t?"inline":"html"),a.type=i),"inline"===i||"html"===i?(a.content||(a.content="inline"===i?n("string"===n.type(e)?e.replace(/.*(?=#[^\s]+$)/,""):e):r),a.content&&a.content.length||(i=null)):e||(i=null),a.group=o.group,a.isDom=t,a.href=e,"image"===i?o._loadImage():"ajax"===i?o._loadAjax():i?o._afterLoad():o._error("type"))},_error:function(e){o.hideLoading(),n.extend(o.coming,{type:"html",autoSize:!0,minHeight:0,hasError:e,content:o.coming.tpl.error}),o._afterLoad()},_loadImage:function(){o.imgPreload=new Image,o.imgPreload.onload=function(){this.onload=this.onerror=null,o.coming.width=this.width,o.coming.height=this.height,o._afterLoad()},o.imgPreload.onerror=function(){this.onload=this.onerror=null,o._error("image")},o.imgPreload.src=o.coming.href,o.imgPreload.width||o.showLoading()},_loadAjax:function(){o.showLoading(),o.ajaxLoad=n.ajax(n.extend({},o.coming.ajax,{url:o.coming.href,error:function(e,t){"abort"!==t?o._error("ajax",e):o.hideLoading()},success:function(e,t){"success"===t&&(o.coming.content=e,o._afterLoad())}}))},_preloadImages:function(){var e,t=o.group,i=o.current,s=t.length;if(i.preload&&!(2>t.length))for(var a=1;a<=Math.min(i.preload,s-1);a++)e=t[(i.index+a)%s],(e=n(e).attr("href")||e)&&((new Image).src=e)},_afterLoad:function(){o.hideLoading(),o.coming&&!1!==o.trigger("afterLoad",o.current)?(o.isOpened?(n(".fancybox-item").remove(),o.wrap.stop(!0).removeClass("fancybox-opened"),o.inner.css("overflow","hidden"),o.transitions[o.current.prevMethod]()):(n(".fancybox-wrap").stop().trigger("onReset").remove(),o.trigger("afterClose")),o.unbindEvents(),o.isOpen=!1,o.current=o.coming,o.wrap=n(o.current.tpl.wrap).addClass("fancybox-"+(r?"mobile":"desktop")+" fancybox-tmp "+o.current.wrapCSS).appendTo("body"),o.outer=n(".fancybox-outer",o.wrap).css("padding",o.current.padding+"px"),o.inner=n(".fancybox-inner",o.wrap),o._setContent()):o.coming=!1},_setContent:function(){var e,t,i=o.current,s=i.type;switch(s){case"inline":case"ajax":case"html":(e=i.content)instanceof n&&((e=e.show().detach()).parent().hasClass("fancybox-inner")&&e.parents(".fancybox-wrap").trigger("onReset").remove(),n(o.wrap).bind("onReset",(function(){e.appendTo("body").hide()}))),i.autoSize&&(t=n('<div class="fancybox-tmp '+o.current.wrapCSS+'"></div>').appendTo("body").append(e),i.width=t.width(),i.height=t.height(),t.width(o.current.width),t.height()>i.height&&(t.width(i.width+1),i.width=t.width(),i.height=t.height()),e=t.contents().detach(),t.remove());break;case"image":e=i.tpl.image.replace("{href}",i.href),i.aspectRatio=!0;break;case"swf":e=i.tpl.swf.replace(/\{width\}/g,i.width).replace(/\{height\}/g,i.height).replace(/\{href\}/g,i.href)}if("iframe"===s){if(e=n(i.tpl.iframe.replace("{rnd}",(new Date).getTime())).attr("scrolling",i.scrolling),i.scrolling="auto",i.autoSize)return e.width(i.width),o.showLoading(),void e.data("ready",!1).appendTo(o.inner).bind({onCancel:function(){n(this).unbind(),o._afterZoomOut()},load:function(){var e,t=n(this);try{this.contentWindow.document.location&&(e=t.contents().find("body").height()+12,t.height(e))}catch(e){i.autoSize=!1}!1===t.data("ready")?(o.hideLoading(),e&&(o.current.height=e),o._beforeShow(),t.data("ready",!0)):e&&o.update()}}).attr("src",i.href);e.attr("src",i.href)}else"image"!==s&&"swf"!==s||(i.autoSize=!1,i.scrolling="visible");o.inner.append(e),o._beforeShow()},_beforeShow:function(){o.coming=null,o.trigger("beforeShow"),o._setDimension(),o.wrap.hide().removeClass("fancybox-tmp"),o.bindEvents(),o._preloadImages(),o.transitions[o.isOpened?o.current.nextMethod:o.current.openMethod]()},_setDimension:function(){var e,t=o.wrap,i=o.outer,s=o.inner,a=o.current,r=o.getViewport(),l=a.margin,c=2*a.padding,d=a.width,u=a.height,h=a.maxWidth,m=a.maxHeight,p=a.minWidth,f=a.minHeight;if(r.w-=l[1]+l[3],r.h-=l[0]+l[2],-1<d.toString().indexOf("%")&&(d=(r.w-c)*parseFloat(d)/100),-1<u.toString().indexOf("%")&&(u=(r.h-c)*parseFloat(u)/100),l=d/u,d+=c,u+=c,a.fitToView&&(h=Math.min(r.w,h),m=Math.min(r.h,m)),a.aspectRatio?(d>h&&(u=((d=h)-c)/l+c),u>m&&(d=((u=m)-c)*l+c),d<p&&(u=((d=p)-c)/l+c),u<f&&(d=((u=f)-c)*l+c)):(d=Math.max(p,Math.min(d,h)),u=Math.max(f,Math.min(u,m))),d=Math.round(d),u=Math.round(u),n(t.add(i).add(s)).width("auto").height("auto"),s.width(d-c).height(u-c),t.width(d),e=t.height(),d>h||e>m)for(;(d>h||e>m)&&d>p&&e>f;)u-=10,a.aspectRatio?(d=Math.round((u-c)*l+c))<p&&(u=((d=p)-c)/l+c):d-=10,s.width(d-c).height(u-c),t.width(d),e=t.height();a.dim={width:d,height:e},a.canGrow=a.autoSize&&u>f&&u<m,a.canShrink=!1,a.canExpand=!1,d-c<a.width||u-c<a.height?a.canExpand=!0:(d>r.w||e>r.h)&&d>p&&u>f&&(a.canShrink=!0),t=e-c,o.innerSpace=t-s.height(),o.outerSpace=t-i.height()},_getPosition:function(e){var t=o.current,n=o.getViewport(),i=t.margin,s=o.wrap.width()+i[1]+i[3],a=o.wrap.height()+i[0]+i[2],r={position:"absolute",top:i[0]+n.y,left:i[3]+n.x};return t.fixed&&(!e||!1===e[0])&&a<=n.h&&s<=n.w&&(r={position:"fixed",top:i[0],left:i[3]}),r.top=Math.ceil(Math.max(r.top,r.top+(n.h-a)*t.topRatio))+"px",r.left=Math.ceil(Math.max(r.left,r.left+.5*(n.w-s)))+"px",r},_afterZoomIn:function(){var e=o.current,t=e.scrolling;o.isOpen=o.isOpened=!0,o.wrap.addClass("fancybox-opened").css("overflow","visible"),o.update(),o.inner.css("overflow","yes"===t?"scroll":"no"===t?"hidden":t),(e.closeClick||e.nextClick)&&o.inner.css("cursor","pointer").bind("click.fb",e.nextClick?o.next:o.close),e.closeBtn&&n(e.tpl.closeBtn).appendTo(o.outer).bind("click.fb",o.close),e.arrows&&1<o.group.length&&((e.loop||0<e.index)&&n(e.tpl.prev).appendTo(o.inner).bind("click.fb",o.prev),(e.loop||e.index<o.group.length-1)&&n(e.tpl.next).appendTo(o.inner).bind("click.fb",o.next)),o.trigger("afterShow"),o.opts.autoPlay&&!o.player.isActive&&(o.opts.autoPlay=!1,o.play())},_afterZoomOut:function(){o.trigger("afterClose"),o.wrap.trigger("onReset").remove(),n.extend(o,{group:{},opts:{},current:null,isActive:!1,isOpened:!1,isOpen:!1,wrap:null,outer:null,inner:null})}}),o.transitions={getOrigPosition:function(){var e=o.current,t=e.element,i=e.padding,s=n(e.orig),a={},r=50,l=50;return!s.length&&e.isDom&&n(t).is(":visible")&&((s=n(t).find("img:first")).length||(s=n(t))),s.length?(a=s.offset(),s.is("img")&&(r=s.outerWidth(),l=s.outerHeight())):(e=o.getViewport(),a.top=e.y+.5*(e.h-l),a.left=e.x+.5*(e.w-r)),{top:Math.ceil(a.top-i)+"px",left:Math.ceil(a.left-i)+"px",width:Math.ceil(r+2*i)+"px",height:Math.ceil(l+2*i)+"px"}},step:function(e,t){var n,i,s;"width"!==t.prop&&"height"!==t.prop||(i=s=Math.ceil(e-2*o.current.padding),"height"===t.prop&&(n=(e-t.start)/(t.end-t.start),t.start>t.end&&(n=1-n),i-=o.innerSpace*n,s-=o.outerSpace*n),o.inner[t.prop](i),o.outer[t.prop](s))},zoomIn:function(){var e,t,i=o.wrap,s=o.current;e=s.dim,"elastic"===s.openEffect?(delete(t=n.extend({},e,o._getPosition(!0))).position,e=this.getOrigPosition(),s.openOpacity&&(e.opacity=0,t.opacity=1),o.outer.add(o.inner).width("auto").height("auto"),i.css(e).show(),i.animate(t,{duration:s.openSpeed,easing:s.openEasing,step:this.step,complete:o._afterZoomIn})):(i.css(n.extend({},e,o._getPosition())),"fade"===s.openEffect?i.fadeIn(s.openSpeed,o._afterZoomIn):(i.show(),o._afterZoomIn()))},zoomOut:function(){var e,t=o.wrap,n=o.current;"elastic"===n.closeEffect?("fixed"===t.css("position")&&t.css(o._getPosition(!0)),e=this.getOrigPosition(),n.closeOpacity&&(e.opacity=0),t.animate(e,{duration:n.closeSpeed,easing:n.closeEasing,step:this.step,complete:o._afterZoomOut})):t.fadeOut("fade"===n.closeEffect?n.closeSpeed:0,o._afterZoomOut)},changeIn:function(){var e,t=o.wrap,n=o.current;"elastic"===n.nextEffect?((e=o._getPosition(!0)).opacity=0,e.top=parseInt(e.top,10)-200+"px",t.css(e).show().animate({opacity:1,top:"+=200px"},{duration:n.nextSpeed,easing:n.nextEasing,complete:o._afterZoomIn})):(t.css(o._getPosition()),"fade"===n.nextEffect?t.hide().fadeIn(n.nextSpeed,o._afterZoomIn):(t.show(),o._afterZoomIn()))},changeOut:function(){var e=o.wrap,t=o.current,i=function(){n(this).trigger("onReset").remove()};e.removeClass("fancybox-opened"),"elastic"===t.prevEffect?e.animate({opacity:0,top:"+=200px"},{duration:t.prevSpeed,easing:t.prevEasing,complete:i}):e.fadeOut("fade"===t.prevEffect?t.prevSpeed:0,i)}},o.helpers.overlay={overlay:null,update:function(){var e;this.overlay.width(0).height(0),n.browser.msie?e=(e=Math.max(t.documentElement.scrollWidth,t.body.scrollWidth))<Math.max(t.documentElement.offsetWidth,t.body.offsetWidth)?i.width():e:e=s.width(),this.overlay.width(e).height(s.height())},beforeShow:function(e){this.overlay||(e=n.extend(!0,{speedIn:"fast",closeClick:!0,opacity:1,css:{background:"black"}},e),this.overlay=n('<div id="fancybox-overlay"></div>').css(e.css).appendTo("body"),this.update(),e.closeClick&&this.overlay.bind("click.fb",o.close),i.bind("resize.fb",n.proxy(this.update,this)),this.overlay.fadeTo(e.speedIn,e.opacity))},onUpdate:function(){this.update()},afterClose:function(e){this.overlay&&this.overlay.fadeOut(e.speedOut||0,(function(){n(this).remove()})),this.overlay=null}},o.helpers.title={beforeShow:function(e){var t;(t=o.current.title)&&(t=n('<div class="fancybox-title fancybox-title-'+e.type+'-wrap">'+t+"</div>").appendTo("body"),"float"===e.type&&(t.width(t.width()),t.wrapInner('<span class="child"></span>'),o.current.margin[2]+=Math.abs(parseInt(t.css("margin-bottom"),10))),t.appendTo("over"===e.type?o.inner:"outside"===e.type?o.wrap:o.outer))}},n.fn.fancybox=function(e){var t,i=n(this),a=this.selector||"",r=function(s){var r=this,l="rel",c=r[l],d=t;!s.ctrlKey&&!s.altKey&&!s.shiftKey&&!s.metaKey&&(s.preventDefault(),c||(l="data-fancybox-group",c=n(r).attr("data-fancybox-group")),c&&""!==c&&"nofollow"!==c&&(d=(r=(r=a.length?n(a):i).filter("["+l+'="'+c+'"]')).index(this)),e.index=d,o.open(r,e))};return t=(e=e||{}).index||0,a?s.undelegate(a,"click.fb-start").delegate(a,"click.fb-start",r):i.unbind("click.fb-start").bind("click.fb-start",r),this}}(window,document,jQuery),
/*!
* overides fancybox jquery plugin to provide horizontal transition
* and w/ a new overlay helper that's fixed positioned
* <div id="ible-fancybox-overlay"></div>
*/
function(e,t){var n=e(window);e.extend(t.defaults,{wrapCSS:"ible-fancybox",scrolling:"visible",aspectRatio:!0,loop:!1,prevSpeed:600,nextSpeed:600,keys:{next:[13,32,39],prev:[37],close:[27]},helpers:{overlay:null,PhotosetOverlay:{}}}),t.transitions.changeIn=function(){var e=t.wrap,n=t.current,i=t._getPosition(!0);t.isForward?(i.left=parseInt(i.left,10)+1500+"px",e.css(i).show().animate({left:"-=1500px"},{duration:n.nextSpeed,complete:t._afterZoomIn})):(i.left=parseInt(i.left,10)-1500+"px",e.css(i).show().animate({left:"+=1500px"},{duration:n.nextSpeed,complete:t._afterZoomIn}))},t.transitions.changeOut=function(){var n,i=t.wrap,s=t.current;i.removeClass("fancybox-opened"),n=t.isForward?"-=1500px":"+=1500px","elastic"===s.prevEffect&&i.animate({opacity:.4,left:n},{duration:s.prevSpeed,complete:function(){e(this).trigger("onReset").remove()}})},t.next=function(){t.current&&(t.isForward=!0,t.jumpto(t.current.index+1))},t.prev=function(){t.current&&(t.isForward=!1,t.jumpto(t.current.index-1))},t.closeOrig=t.close,t.close=function(n){if("object"==typeof n&&n.target){var i=e(n.target);(i.attr("id")===t.overlayId||i.hasClass("fancybox-close")&&e(this).attr("id")!==t.overlayId||i.hasClass("transparency"))&&t.closeOrig(n)}else t.closeOrig(n)},t._afterZoomOut=function(){t.trigger("afterClose")},t.getViewport=function(){return{x:n.scrollLeft(),y:0,w:n.width(),h:n.height()}},t.originalUrl=window.location.href,t.overlayId="ible-fancybox-overlay",t.overlayWrap='<div id="'+t.overlayId+'"><div class="transparency"></div></div>',t.helpers.PhotosetOverlay={overlay:null,beforeLoad:function(n){this.overlay||(n=e.extend(!0,{speedIn:"fast",closeClick:!0},n),this.overlay=e(t.overlayWrap).appendTo("body"),n.closeClick&&this.overlay.bind("click.fb",t.close),this.overlay.fadeTo(n.speedIn,n.opacity))},beforeShow:function(e){t.wrap.detach().appendTo("div#"+t.overlayId)},afterClose:function(n){t.wrap.trigger("onReset").remove(),this.overlay&&(this.overlay.remove(),this.overlay=null),e.extend(t,{group:{},opts:{},current:null,isActive:!1,isOpened:!1,isOpen:!1,wrap:null,outer:null,inner:null})}}}(jQuery,jQuery.fancybox),Ibles.views.FancyboxView=Backbone.View.extend({initialize:function(e){_.bindAll(this,"beforeShow","afterShow","afterClose"),this.menuBarView=null,this.opts=e,this.opts.targets.fancybox({beforeShow:this.beforeShow,afterShow:this.afterShow,afterClose:this.afterClose})},beforeShow:function(){this.cleanupMenuBar()},afterShow:function(){this.opts.afterShow&&this.opts.afterShow();var e=this.getCurrentImageUrl();Ibles.isGif(e)?this.swapGifWithVideo():Ibles.isCdnUrl(e)&&this.setupMenuBar()},afterClose:function(){this.cleanupMenuBar()},setupMenuBar:function(){var e=this.opts.canRotate;this.menuBarView=new Ibles.views.FancyboxMenuBar({el:$("#ible-fancybox-overlay"),showRotateOption:e&&e()})},cleanupMenuBar:function(){this.menuBarView&&(this.menuBarView.destroy(),this.menuBarView=null)},getCurrentImageUrl:function(){return $.fancybox.current.href},swapGifWithVideo:function(){var e=this.getCurrentImageUrl();Ibles.isGif(e)&&$("#ible-fancybox-overlay").find(".fancybox-image").replaceWith($("<video>",{class:"gif-video",autoplay:!0,muted:!0,playsinline:!0,controls:!0,src:Ibles.updateQueryParameter(e,"format","mp4")}).show())}}),Ibles.views.FancyboxMenuBar=Backbone.View.extend({events:{"click .image-rotate-angle":"rotate","click .image-rotate-save":"saveRotation"},initialize:function(e){this.angle=0,this.rotationCountSinceLastSave=0,this.$img=this.$(".fancybox-image"),this.$menuBar=null,this.showRotateOption=e.showRotateOption,this.originalHeight=this.$img.height(),this.originalWidth=this.$img.width(),this.appendMenuBar()},destroy:function(){this.$img=null,this.$menuBar=null,this.stopListening(),this.undelegateEvents()},appendMenuBar:function(){this.$menuBar=$('<div class="fancybox-menu-bar">'),$.fancybox.inner.append(this.$menuBar),this.appendDownloadLink(),this.showRotateOption&&(this.appendRotateAction(),this.appendSaveBtn())},appendDownloadLink:function(){this.$menuBar.append($("<a>",{class:"ible-download-link",title:"Download Original",target:"_blank",href:$($.fancybox.current.element).data("download").split("?")[0]}).append($("<img>",{src:Ibles.staticUrl("img/icon-download.png")}))).click((function(){Ibles.gaUserEvent("overlayImageDownload",{eventLabel:"photoset",eventValue:!0})}))},appendRotateAction:function(){this.$menuBar.append($("<a>",{class:"image-rotate-angle",title:"Rotate Image"}).append($("<img>",{src:Ibles.staticUrl("svg/rotate.svg")})))},appendSaveBtn:function(){this.$menuBar.append($("<a>",{class:"image-rotate-save btn btn-orange",title:"Save Image"}).data({"loading-text":"Loading...","failed-text":"Failed","complete-text":"Success!"}).text("Save"))},rotate:function(){var e=this.originalHeight,t=this.originalWidth,n=0,i=1;switch(this.angle){case 0:n=90,i=t>=e?e/t:t/e;break;case 90:n=180,i=1;break;case 180:n=270,i=t>=e?e/t:t/e;break;case 270:n=0,i=1}this.angle=n,this.rotationCountSinceLastSave++,this.transform(this.$img,i,n),this.$(".image-rotate-save").show()},transform:function(e,t,n){var i=`scale(${t}) rotate(${n}deg)`,s=e.get(0);s.style.WebkitTransform=i,s.style.msTransform=i,s.style.transform=i},saveRotation:function(e){var t,n=this,i=$.fancybox.current,s=i.href,o=$(i.element),a=o.data("fileid"),r=this.rotationCountSinceLastSave%4*90;t=(new Ibles.services.ImageRotationService).rotateFileId(a,r).done((function(e){var t=e.file,i=window.md5(t.modifiedDate),a=s.split("?")[0]+`?md=${i}`;o.attr("href",a),o.find("img").attr("src",a),n.rotationCountSinceLastSave=0})),Ibles.syncButtonStatesToRequest($(e.currentTarget),t)}}),Ibles.JST.photoset='<[ if (numVideos) {]>\n<div class="videoset-wrapper">   \n    <div class="videoset"></div>\n</div>\n<[}]>\n<[ if (numImages) {]>\n<div class="photoset-wrapper">\n    <div class="photoset"></div>\n</div>\n<[}]> \n',Ibles.JST["videoset-cell"]='<div class="videoset-cell">\n    <div class="videoset-item">\n        << embedHtmlCode >>\n    </div>\n</div>\n',Ibles.JST["videoset-youtube-cell"]="<iframe\n    allowfullscreen\n    src=\"https://www.youtube.com/embed/<< videoID >>?feature=oembed\"\n    srcdoc=\"\n        <style>\n        *{padding:0;margin:0;overflow:hidden}\n        html,body{height:100%}\n        img,span{position:absolute;width:100%;top:0;bottom:0;margin:auto}\n        span:hover{color:red}\n        span{height:1.5em;text-align:center;font:48px/1.5 sans-serif;color:white;text-shadow:0 0 0.5em black;}\n        .title{position:absolute;z-index:1;font-size:larger;font-family:'myriad-pro', sans-serif; padding:1em;color:white;}\n        .watchOnYT{position:absolute;z-index:1;bottom:0;left:0;padding:1em;font-family:'myriad-pro', sans-serif;color:white;background:rgba(0,0,0,0.5)}\n        .watchOnYT a{color:white;text-decoration:none}\n        .watchOnYT svg{position:relative;top:3px;}\n        </style>\n        <div class='title'><< name >></div>\n        <div class='watchOnYT'>\n            <a target='_blank' href='https://www.youtube.com/watch?v=<< videoID >>'>\n            Watch on\n            <svg height='100%' version='1.1' viewBox='0 0 110 26' fill='white' width='75'><use class='ytp-svg-shadow' xlink:href='#ytp-id-30'></use><path class='ytp-svg-fill' d='M 16.68,.99 C 13.55,1.03 7.02,1.16 4.99,1.68 c -1.49,.4 -2.59,1.6 -2.99,3 -0.69,2.7 -0.68,8.31 -0.68,8.31 0,0 -0.01,5.61 .68,8.31 .39,1.5 1.59,2.6 2.99,3 2.69,.7 13.40,.68 13.40,.68 0,0 10.70,.01 13.40,-0.68 1.5,-0.4 2.59,-1.6 2.99,-3 .69,-2.7 .68,-8.31 .68,-8.31 0,0 .11,-5.61 -0.68,-8.31 -0.4,-1.5 -1.59,-2.6 -2.99,-3 C 29.11,.98 18.40,.99 18.40,.99 c 0,0 -0.67,-0.01 -1.71,0 z m 72.21,.90 0,21.28 2.78,0 .31,-1.37 .09,0 c .3,.5 .71,.88 1.21,1.18 .5,.3 1.08,.40 1.68,.40 1.1,0 1.99,-0.49 2.49,-1.59 .5,-1.1 .81,-2.70 .81,-4.90 l 0,-2.40 c 0,-1.6 -0.11,-2.90 -0.31,-3.90 -0.2,-0.89 -0.5,-1.59 -1,-2.09 -0.5,-0.4 -1.10,-0.59 -1.90,-0.59 -0.59,0 -1.18,.19 -1.68,.49 -0.49,.3 -1.01,.80 -1.21,1.40 l 0,-7.90 -3.28,0 z m -49.99,.78 3.90,13.90 .18,6.71 3.31,0 0,-6.71 3.87,-13.90 -3.37,0 -1.40,6.31 c -0.4,1.89 -0.71,3.19 -0.81,3.99 l -0.09,0 c -0.2,-1.1 -0.51,-2.4 -0.81,-3.99 l -1.37,-6.31 -3.40,0 z m 29.59,0 0,2.71 3.40,0 0,17.90 3.28,0 0,-17.90 3.40,0 c 0,0 .00,-2.71 -0.09,-2.71 l -9.99,0 z m -53.49,5.12 8.90,5.18 -8.90,5.09 0,-10.28 z m 89.40,.09 c -1.7,0 -2.89,.59 -3.59,1.59 -0.69,.99 -0.99,2.60 -0.99,4.90 l 0,2.59 c 0,2.2 .30,3.90 .99,4.90 .7,1.1 1.8,1.59 3.5,1.59 1.4,0 2.38,-0.3 3.18,-1 .7,-0.7 1.09,-1.69 1.09,-3.09 l 0,-0.5 -2.90,-0.21 c 0,1 -0.08,1.6 -0.28,2 -0.1,.4 -0.5,.62 -1,.62 -0.3,0 -0.61,-0.11 -0.81,-0.31 -0.2,-0.3 -0.30,-0.59 -0.40,-1.09 -0.1,-0.5 -0.09,-1.21 -0.09,-2.21 l 0,-0.78 5.71,-0.09 0,-2.62 c 0,-1.6 -0.10,-2.78 -0.40,-3.68 -0.2,-0.89 -0.71,-1.59 -1.31,-1.99 -0.7,-0.4 -1.48,-0.59 -2.68,-0.59 z m -50.49,.09 c -1.09,0 -2.01,.18 -2.71,.68 -0.7,.4 -1.2,1.12 -1.49,2.12 -0.3,1 -0.5,2.27 -0.5,3.87 l 0,2.21 c 0,1.5 .10,2.78 .40,3.78 .2,.9 .70,1.62 1.40,2.12 .69,.5 1.71,.68 2.81,.78 1.19,0 2.08,-0.28 2.78,-0.68 .69,-0.4 1.09,-1.09 1.49,-2.09 .39,-1 .49,-2.30 .49,-3.90 l 0,-2.21 c 0,-1.6 -0.2,-2.87 -0.49,-3.87 -0.3,-0.89 -0.8,-1.62 -1.49,-2.12 -0.7,-0.5 -1.58,-0.68 -2.68,-0.68 z m 12.18,.09 0,11.90 c -0.1,.3 -0.29,.48 -0.59,.68 -0.2,.2 -0.51,.31 -0.81,.31 -0.3,0 -0.58,-0.10 -0.68,-0.40 -0.1,-0.3 -0.18,-0.70 -0.18,-1.40 l 0,-10.99 -3.40,0 0,11.21 c 0,1.4 .18,2.39 .68,3.09 .49,.7 1.21,1 2.21,1 1.4,0 2.48,-0.69 3.18,-2.09 l .09,0 .31,1.78 2.59,0 0,-14.99 c 0,0 -3.40,.00 -3.40,-0.09 z m 17.31,0 0,11.90 c -0.1,.3 -0.29,.48 -0.59,.68 -0.2,.2 -0.51,.31 -0.81,.31 -0.3,0 -0.58,-0.10 -0.68,-0.40 -0.1,-0.3 -0.21,-0.70 -0.21,-1.40 l 0,-10.99 -3.40,0 0,11.21 c 0,1.4 .21,2.39 .71,3.09 .5,.7 1.18,1 2.18,1 1.39,0 2.51,-0.69 3.21,-2.09 l .09,0 .28,1.78 2.62,0 0,-14.99 c 0,0 -3.40,.00 -3.40,-0.09 z m 20.90,2.09 c .4,0 .58,.11 .78,.31 .2,.3 .30,.59 .40,1.09 .1,.5 .09,1.21 .09,2.21 l 0,1.09 -2.5,0 0,-1.09 c 0,-1 -0.00,-1.71 .09,-2.21 0,-0.4 .11,-0.8 .31,-1 .2,-0.3 .51,-0.40 .81,-0.40 z m -50.49,.12 c .5,0 .8,.18 1,.68 .19,.5 .28,1.30 .28,2.40 l 0,4.68 c 0,1.1 -0.08,1.90 -0.28,2.40 -0.2,.5 -0.5,.68 -1,.68 -0.5,0 -0.79,-0.18 -0.99,-0.68 -0.2,-0.5 -0.31,-1.30 -0.31,-2.40 l 0,-4.68 c 0,-1.1 .11,-1.90 .31,-2.40 .2,-0.5 .49,-0.68 .99,-0.68 z m 39.68,.09 c .3,0 .61,.10 .81,.40 .2,.3 .27,.67 .37,1.37 .1,.6 .12,1.51 .12,2.71 l .09,1.90 c 0,1.1 .00,1.99 -0.09,2.59 -0.1,.6 -0.19,1.08 -0.49,1.28 -0.2,.3 -0.50,.40 -0.90,.40 -0.3,0 -0.51,-0.08 -0.81,-0.18 -0.2,-0.1 -0.39,-0.29 -0.59,-0.59 l 0,-8.5 c .1,-0.4 .29,-0.7 .59,-1 .3,-0.3 .60,-0.40 .90,-0.40 z' id='ytp-id-30'></path></svg>\n            </a>\n        </div>\n        <a href='https://www.youtube.com/embed/<< videoID >>?feature=oembed&autoplay=1'>\n            <img src='https://img.youtube.com/vi/<< videoID >>/hqdefault.jpg' alt='<< name >>' />\n            <span>\n            <svg height='100%' version='1.1' viewBox='0 0 68 48' width='100%'><path class='ytp-large-play-button-bg' d='M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z' fill='#f00'></path><path d='M 45,24 27,14 27,34' fill='#fff'></path></svg>\n            </span>\n        </a>\"\n    width=\"1024\"\n    height=\"576\"\n    loading=\"lazy\"\n    frameborder=\"0\">\n</iframe>\n",Ibles.JST["photoset-cell"]='<div class="photoset-item photoset-cell" style="-webkit-flex: << aspectRatio >>; flex: << aspectRatio >>;">\n    <div class="photoset-image">\n        <[ if (isGif) {]>\n            <video class="gif-video" controls autoplay muted loop playsinline>\n                <source src="<< mp4Url >>" type="video/mp4">\n            </video>\n        <[ } else { ]>\n            <a class="gallery-link" rel="<< galleryId >>" href="<< overlayImageUrl >>" data-download="<< imageOriginalUrl >>" data-fileid="<< fileId >>">\n                <img class="lazyload" alt="<< title >>" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-src="<< resizedImageUrl >>" <[ if (isGif) {]>data-gif-url="<< gifUrl >>"<[}]>>\n                <[ if (!_.isEmpty(imageNotes)) { ]>\n                    <i class="notes-icon"></i>\n                <[ } ]>\n            </a>\n        <[ } ]>\n    </div>\n</div>\n',function(e){e.fn.notes=function(t){var n;return(n={}).init=function(t,i,s){return n.setEditable(i),this.each((function(){var i,o;return o=e(this),i=e('<div class="note-holder"></div>'),setTimeout((function(){var a,r,l,c,d,u;if(r=n.extractInfo(o,s),i.addClass(r.imgId),i.attr("id","holder_"+r.imgId),n.placeNoteHolder(i,r),null!=s?s.append(i):e("body").append(i),n.editable&&(i.css({"z-index":200}),n.bindNoteHolder(i)),a=function(e){var t;return e.parentWidth=r.width,e.parentHeight=r.height,e.noteHolder=i,t=[e],n.display.apply(o,t)},t){for(u=[],c=0,d=t.length;c<d;c++)l=t[c],u.push(a(l));return u}}),10)}))},n.extractInfo=function(e,t){var n,i,s,o,a;return a=e.width(),s=e.height(),i=e.attr("class"),o=t?e.offsetParent().position():e.offset(),null!=i&&(n=i.indexOf(" ")),{width:a,height:s,offset:o,imgId:null!=n&&-1!==n?i.split(" ")[1]:i}},n.placeNoteHolder=function(e,t){if(null!=t&&null!=t.offset)return e.css({left:t.offset.left+"px",top:t.offset.top+"px"})},n.buildNoteInfo=function(e,t){var n,i,s,o,a,r,l,c,d,u,h;return c=e.position(),a=(o=e.parent()).width(),s=o.height(),r=o.attr("class").split(" ")[1].substring(3),(n={}).action=t,n.imageID=r,u=c.top/s,l=c.left/a,h=e.width()/a,i=e.height()/s,(d=e.find("textarea").val())||(d=e.find(".note-text-value").html()),d&&(n.text=d.replace(/\n/g,"<br/>").replace(/"/g,'\\"')),n.json='{"top":'+u+',"left":'+l+',"width":'+h+',"height":'+i+',"text":"'+n.text+'"}',n},n.add=function(t){var i;return i=n.buildNoteInfo(t,"ADD"),e.post("/ajax/imageNote",i,(function(e){return t.attr("id",e),t.find(".note-text").html(n.buildTextNode(i.text.replace(/\\"/g,'"'))),n.bind(t)}),"text")},n.buildTextNode=function(t){return e('<div class="note-text-value">'+t+'</div><a class="edit-note" href="#">edit</a>')},n.buildEditNode=function(t,n){return t=t.replace(/<br>/g,"\n"),e(n?"<textarea>"+t+'</textarea><br/><a class="delete little-button" href="#">delete</a><a class="'+n+' little-button" href="#">save</a>':"<textarea>"+t+'</textarea><br/><a class="delete little-button" href="#">delete</a><a class="save little-button" href="#">save</a>')},n.save=function(t){var i;if((i=n.buildNoteInfo(t,"MODIFY")).noteID=t.attr("id"),i.noteID)return e.post("/ajax/imageNote",i,(function(e){return n.bind(t)}))},n.update=function(t){var i,s;return s=(i=t.find(".note-text")).find(".note-text-value").html(),i.html(n.buildEditNode(s,"edit")),n.bind(t),i.find("a.edit").click((function(s){var o;return s.preventDefault(),null!=(o=n.buildNoteInfo(t,"MODIFY")).text?(o.noteID=t.attr("id"),e.post("/ajax/imageNote",o,(function(e){return i.html(n.buildTextNode(i.find("textarea").val())),n.bind(t)}))):feedBack.add("Please enter text in order to save.")}))},n.remove=function(t){var i;return(i=n.buildNoteInfo(t,"DELETE")).noteID=t.attr("id"),i.noteID&&e.post("/ajax/imageNote",i),t.fadeOut((function(){return t.remove()}))},n.bindNoteHolder=function(t){var i;return i=null,e("div.note-holder").mousedown((function(e){return e.preventDefault(),i=n.userCreateBox(e,t),n.bind(i,i.height())})),this},n.display=function(e){var t,i,s,o;return t=Math.round(e.parentWidth*e.left),o=Math.round(e.parentHeight*e.top),s=Math.round(e.parentWidth*e.width),i=Math.round(e.parentHeight*e.height),n.drawBox({left:t,top:o,width:s,height:i,note:e}),this},n.drawBox=function(t){var i,s;return s=t.note.id?t.note.id:t.note.noteID,i=e('<div id="'+s+'" class="note-border"><div class="note-text"><div class="note-text-value">'+t.note.text+"</div></div></div>"),t.note.noteHolder.append(i),n.editable&&i.find(".note-text").append('<a href="#" class="edit-note">edit</a>'),i.css({width:t.width+"px",left:t.left+"px",height:t.height+"px",top:t.top+"px"}),n.bind(i,t.height),this},n.userCreateBox=function(t,i){var s;return(s=e('<div class="note-border"><div class="note-text"></div></div>')).find(".note-text").append(n.buildEditNode("")),i.append(s),s.mousedown((function(e){return e.stopPropagation()})),/MSIE (\d+\.\d+);/.test(navigator.userAgent)?s.css({top:t.offsetY+"px",left:t.offsetX+"px",width:"50px",height:"50px"}):s.css({top:t.layerY+"px",left:t.layerX+"px",width:"50px",height:"50px"}),s},n.updateBoxSize=function(e,t){var n;return n=t.position(),t.css({width:Math.abs(n.left+e.layerX)+"px",height:Math.abs(n.top+e.layerY)+"px"})},n.setNoteTextTop=function(e,t){return e.css({top:t+"px"})},n.noteHover=function(t,i,s){var o;return o=this,t.hover((function(){return clearTimeout(o.timer),n.setNoteTextTop(s,i),e("div.note-text").hide(),s.show()}),(function(){return clearTimeout(o.timer),o.timer=setTimeout((function(){return s.fadeOut()}),1500)}))},n.setEditable=function(e){return this.editable=e,this},n.bind=function(e,t){var i,s;if(s=e.find("div.note-text"),i=n.noteHover(e,t,s),n.editable)return this,null!=e.resizable&&e.resizable({containment:"parent",start:function(t,n){return s.hide(),e.unbind("hover",i)},resize:function(t,n){return s.hide(),e.unbind("hover",i)},stop:function(o,a){return t=e.height(),i=n.noteHover(e,t,s),n.setNoteTextTop(s,t),n.save(e),s.show()}}),null!=e.draggable&&e.draggable({containment:"parent",stop:function(t,i){return n.save(e)}}),e.mousedown((function(e){return e.stopPropagation()})),s.find("a.save").click((function(t){return t.preventDefault(),n.add(e)})),s.find("a.delete").click((function(t){return t.preventDefault(),n.remove(e)})),s.find("a.edit-note").click((function(t){return t.preventDefault(),n.update(e)}))},n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?e.error("Method "+t+" does not exist on jQuery.notes"):n.init.apply(this,arguments)}}(window.jQuery),function(e,t,n){e.package("Ibles.views");var i={enableCropping:!0,maxRowHeight:700,maxWidth:1200,singleRowAspectRatioMax:3/4,minCellAspect:{ratio:2/3,ratioRnded:.7,cropParam:"2:3"},maxCellAspect:{ratio:1.5,ratioRnded:1.5,cropParam:"3:2"},maxImageWidthsByType:{small:320,medium:620,large:1024}};e.views.PhotosetView=Backbone.View.extend({template:_.template(e.JST.photoset),model:null,events:{"click .gallery-link":"renderGalleryOverlay","click .photoset-showmore":"showHiddenRows"},initialize:function(e){var t=_.clone(i);this.title=e.title,this.galleryId=_.uniqueId("photoset"),this.rows=[],this.rowAspectRatios={},this.settings=_.extend(t,_.pick(e,_.keys(t))),this.render(e.fileCollection)},placeImageCellsInRows:function(e){var t,n,i=this.setRowAndColIndexForCells,s=e.length,o=[];if(t=(s-1)%3==0?4:3,i(n=e.slice(0,t),0),o.push(n),s>=5)for(var a,r=e.slice(t),l=r.length,c=0,d=1;c<l;c+=3,d++)(a=r.slice(c,c+3)).length&&(i(a,d),o.push(a));return this.rows=o},setRowAndColIndexForCells:function(e,t){e.forEach((function(e,n){0==t?(e.setRowIndex(0),e.setColIndex(0==n?0:1)):(e.setRowIndex(t),e.setColIndex(n))}))},getRowAspectRatios:function(e){var t,n,i=this,s=i.rowAspectRatios[e];return s||(t=i.rows[e],n=0==e&&i.firstRowRequiresMultiDimensionalLayout()?[t[0].aspectRatio,1/_.reduce(t.slice(1),(function(e,t){return e+1/t.aspectRatio}),0)]:_.map(t,(function(e){return e.aspectRatio})),i.rowAspectRatios[e]=n)},firstRowRequiresMultiDimensionalLayout:function(){var e=this.rows[0],t=this.settings.singleRowAspectRatioMax;return e.length>2&&_.some(_.map(e,(function(e){return e.aspectRatio})),(function(e){return e>t}))},getEffectiveMaxWidth:function(){var e,t,n,i,s,o=this,a=o.effectiveMaxWidth;return a||(t=(e=o.settings).maxWidth,n=e.maxRowHeight,i=o.getRowAspectRatios(0),s=_.reduce(i,(function(e,t){return e+t}),0),o.effectiveMaxWidth=Math.min(n*s,t))},renderGalleryOverlay:function(t){var n=this;t.preventDefault(),new e.views.FancyboxView({targets:this.$(".gallery-link"),afterShow:n.renderImageNotes,canRotate:function(){return n.model.isEditableByCurrentUser()||e.session.isAdmin()}})},renderImageNotes:function(){var e=$.fancybox.inner,t=$($.fancybox.current.element);if(e.length){var n=t.closest(".photoset-cell").data("imagenotes"),i=e.find("img:first");n&&i.notes(n,!1,e)}},showHiddenRows:function(e){e.preventDefault();var t=this,n=t.$(".photoset-showmore"),i=t.$(".hidden-row"),s=i.find("img, video"),o=s.length;t.$(".loading").show(),s.each((function(e,t){$(t).hasClass("gif-video")?--o||(i.removeClass("hidden-row"),n.remove()):(t.src=t.getAttribute("data-src"),t.onload=function(){--o||(i.removeClass("hidden-row"),n.remove())})}))},render:function(e){var t=this,n=e.groupBy((function(e){return"VIDEO"==e.getEmbedType()?"videoFiles":"imageFiles"})),i=n.imageFiles||[],s=n.videoFiles||[],o=i.length,a=s.length,r=$(t.template({numImages:o,numVideos:a}));a&&t.renderVideoFiles(s,r),o&&t.renderImageFiles(i,r),t.$el.append(r)},renderVideoFiles:function(t,n){var i=n.find(".videoset");t.forEach((function(t){var n=new e.views.VideosetCell({file:t});i.append(n.load())}))},renderImageFiles:function(t,i){var s=this,o=i.find(".photoset"),a=t.map((function(t){return new e.views.PhotosetCell({file:t},s)})),r=s.placeImageCellsInRows(a),l=r.length,c=s.settings.maxWidth,d=s.getEffectiveMaxWidth(),u=function(e){var t=n.createElement("div");return t.innerHTML=e,t.firstChild};r.forEach((function(n,i){var a,r,c,d,h,m,p,f=i>0,g=0,b=n.length,v=function(e,t){return u(`<div class="photoset-row items-${t} ${e>0?" hidden-row":""}"></div>`)}(i,b),w=v;0==i&&s.firstRowRequiresMultiDimensionalLayout()&&(c=s.getRowAspectRatios(0),d=c[1],a=u(`<div class="photoset-col" style="-webkit-flex:${d};flex:${d};"></div>`),v.appendChild(n[0].load(f)),v.appendChild(a),w=a,g=1),n.slice(g).forEach((function(e){r=e.load(f),w.appendChild(r)})),0==i&&l>1&&(h=r,m=t.length-b,p=u(`<div class="photoset-showmore"><img class="loading" src="${e.staticUrl("img/ajax_loader_48px.gif")}">${m} More Images</div>`),h.querySelector(".photoset-image").appendChild(p)),o.append(v)})),d<c&&(o.get(0).style.maxWidth=d+"px")}}),e.views.VideosetCell=Backbone.View.extend({template:_.template(e.JST["videoset-cell"]),initialize:function(e){this.file=e.file},load:function(){var t=this.file,i=n.createElement("div"),s=t.getYouTubeVideoID();return i.innerHTML=this.template({embedHtmlCode:t.isYouTubeEmbed()&&s?_.template(e.JST["videoset-youtube-cell"])({name:t.get("name"),videoID:s}):e.makeSafeForSSL(t.getEmbedHtmlCode())}),i.firstChild}}),e.views.PhotosetCell=Backbone.View.extend({template:_.template(e.JST["photoset-cell"]),initialize:function(e,t){var n=this;n.file=e.file,n.photoset=t,n.rowIndex=0,n.colIndex=0,n.setAspectRatio()},setRowIndex:function(e){this.rowIndex=e},setColIndex:function(e){this.colIndex=e},setAspectRatio:function(){var e,t=this,n=t.file,i=n.getWidth()/n.getHeight(),s=Math.round(10*i)/10,o=t.photoset.settings,a=o.minCellAspect,r=o.maxCellAspect,l=a.ratio,c=a.ratioRnded,d=r.ratio,u=r.ratioRnded;s<c?(i=l,e=a.cropParam):s>u&&(i=d,e=r.cropParam),t.aspectRatio=i,t.cropParam=e},load:function(e){var t,i,s,o=this,a=o.file,r=o.photoset,l=o.template({fileId:a.get("id"),title:r.title,galleryId:r.galleryId,resizedImageUrl:o.getCellImageUrl(),isGif:a.isGif(),gifUrl:a.getLargeAnimationUrl(),mp4Url:a.getMp4Url(),overlayImageUrl:a.getLargeUrl(),imageOriginalUrl:a.getOriginalUrl(),imageNotes:a.getImageNotes(),aspectRatio:o.aspectRatio,lazy:e});return(t=n.createElement("div")).innerHTML=l,(s=(i=t.firstChild).dataset)&&(s.imagenotes=JSON.stringify(o.file.getImageNotes()||[])),i},getCellImageUrl:function(){var e=this,t=e.file,n=e.photoset,i=e.rowIndex,s=e.colIndex,o=n.settings,a=n.rows[i].length>1,r=o.enableCropping&&(a||!a&&e.aspectRatio<e.maxCropAspectRatio),l=n.getEffectiveMaxWidth(),c=o.maxImageWidthsByType,d=n.getRowAspectRatios(i),u=_.reduce(d,(function(e,t){return e+t}),0),h=Math.round(d[s]/u*l),m=e.cropParam,p={frame:!0,width:1024,height:1024,fit:"bounds"};return h<t.getWidth()&&h<c.large&&(p.width=h),r&&m&&(p.crop=m),t.getOptimizedImageUrl(p)}})}(Ibles,window,document),Ibles.JST["comment-item"]='<article class="post js-comment <[ if (isReply) {]>reply<[}]> <[ if (!visible) {]>hide<[}]>" data-id="<< id >>" data-stepid="<< stepId >>" <[ if (isReply) {]>data-inreplyto="<< replyAuthor >>"<[}]>>\n    <div class="post-header">\n        <div class="meta">\n            <[ if (Ibles.isDesktop()) {]>\n                <div class="votes js-vote-count <[ if (!upvotingEnabled || !rating) {]>hide<[}]>"><< rating >></div>\n            <[}]>\n\n            <div class="avatar">\n                <a href="<< authorUrl >>">\n                    <img <[ if (lazyImage) {]>class="lazyload" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-<[}]>src="<< avatar >>">\n                </a>\n            </div>\n            <div class="posted-by">\n                <a class="author" href="<< authorUrl >>"><< author >></a>\n                <[ if (isReply) {]>\n                    <i class="icon-arrow-right"></i>\n                    <button class="replied-to js-reply-parent" href="<< Ibles.reverseUrls.memberUrl(replyAuthor) >>"><< replyAuthor >></button>\n                <[}]>\n                <p class="posted-date">\n                    <[ if (isQuestion) {]>\n                    <span class="label question-label">Question</span>\n                    <[} else if (isTip) {]>\n                    <span class="label tip-label">Tip</span>\n                    <[} else if (isBestAnswer) {]>\n                    <span class="label best-answer-label">Best Answer</span>\n                    <[} else if (!isReply) {]>\n\n                    <[} else {]>\n                         <[ if (isAnswer) {]>Answer<[} else {]>Reply<[}]>\n                    <[}]>\n                    << commentTime >>\n                    <[ if (stepId){ ]>on <a class="step-link" href="#<< stepAnchorId >>"><< stepIndexLabel >></a><[}]>\n                </p>\n            </div>\n        </div>\n        <[ if (Ibles.isDesktop()) {]>\n            <div class="toolbar js-toolbar">\n                <[ if (replyEnabled) {]>\n                    <button class="btn reply-btn js-reply"><[ if (isQuestion) {]>Answer<[}else{]>Reply<[}]></button>\n                <[ } ]>\n                <[ if (upvotingEnabled) {]>\n                    <button class="btn vote-btn js-vote-btn">Upvote</button>\n                <[ } ]>\n                <[ if (isAnswer) {]>\n                    <p class="best-answer-actions">\n                        <button class="btn btn-default js-toggle-best-answer hide"><[ if (isAnswer){]>Select as Best Answer<[}else{]>Undo Best Answer<[}]></button>\n                    </p>\n                <[}]>\n            </div>\n        <[}]>\n    </div>\n\n    <div class="text js-text">\n        <p class="quarantine-message js-quarantine-message"></p>\n        << body >>\n    </div>\n\n    <div class="js-edit-container"></div>\n\n    <div class="photos js-photos"></div>\n    <div class="attachments js-attachments"></div>\n\n    <[ if (lastVisibleInThread) {]>\n        <button class="hidden-replies-link js-show-replies">\n            << numRepliesFromMe >>\n            <[ if (isQuestion || isAnswer) {]>\n                << Ibles.pluralize(numRepliesFromMe, "answer", "answers") >>\n            <[} else {]>\n                << Ibles.pluralize(numRepliesFromMe, "reply", "replies") >>\n            <[}]>\n            <i class="icon-arrow-down"></i>\n        </button>\n    <[}]>\n\n    <[ if (Ibles.isMobile()) {]>\n        <div class="toolbar js-toolbar">\n            <div class="votes js-vote-count <[ if (!upvotingEnabled || !rating) {]>hide<[}]>"><< rating >></div>\n            <button class="btn reply-btn js-reply"><[ if (isQuestion) {]>Answer<[}else{]>Reply<[}]></button>\n            <[ if (upvotingEnabled) {]>\n                <button class="btn vote-btn js-vote-btn">Upvote</button>\n            <[ } ]>\n        </div>\n        <[ if (isAnswer) {]>\n            <p class="best-answer-actions">\n                <button class="btn btn-default js-toggle-best-answer hide"><[ if (isAnswer){]>Select as Best Answer<[}else{]>Undo Best Answer<[}]></button>\n            </p>\n        <[}]>\n    <[}]>\n</article>\n',Ibles.JST["comment-toolbar"]='<div class="toolbar js-toolbar">\n    <[ if (Ibles.isMobile()) {]>\n        <div class="votes js-vote-count <[ if (!rating) {]>hide<[}]>"><< rating >></div>\n    <[}]>\n    <button class="btn reply-btn js-reply">\n        <[ if (isQuestion) {]>Answer<[}else{]>Reply<[}]>\n    </button>\n    <[ if (upvotingEnabled) {]>\n    <button class="btn vote-btn js-vote-btn">Upvote</button>\n    <[ } ]>\n<[ if (Ibles.isMobile()) {]>\n</div>\n<[ } ]>\n<[ if (isAnswer) {]>\n    <p class="best-answer-actions">\n        <a class="btn btn-default js-toggle-best-answer hide"><[ if (isAnswer){]>Select as Best Answer<[}else{]>Undo Best Answer<[}]></a>\n    </p>\n<[}]>\n<[ if (Ibles.isDesktop()) {]>\n</div>\n<[ } ]>\n',Ibles.JST["comment-posting-view"]='<div class="discuss <[ if (!typeSelected) {]>discuss-all<[}]>">\n    <[ if (isMobile) {]>\n    <div class="postbox">\n        <img class="poster" src="<< avatar >>">\n        <p class="policy">We have a <b>be nice</b> policy.<br> Be positive and constructive.</p>\n    </div>\n    <[ } ]>\n    <div class="postbox">\n        <[ if (!isMobile) {]>\n        <img class="poster" src="<< avatar >>">\n        <[ } ]>\n        <div class="field js-redactor-container">\n            <[ if (!typeSelected) {]>\n                <button class="type-btn tip-type js-type-tip"><[ if (isMobile){]>Tip<[}else{]>Add Tip<[}]></button>\n                <button class="type-btn question-type js-type-question"><[ if (isMobile){]>Question<[}else{]>Ask Question<[}]></button>\n                <button class="type-btn comment-type js-type-comment"><[ if (isMobile){]>Comment<[}else{]>Post Comment<[}]></button>\n            <[ } else { ]>\n                <div class="comment-tip redactor-tooltip" data-toggle="tooltip" data-placement="top" title="Highlight text to apply styling"></div>\n                <textarea class="body-input js-body-input redactor-textarea"><[ if (commentBody){ ]><< commentBody >><[}]></textarea>\n            <[ } ]>\n        </div>\n    </div>\n    <div class="image-bucket js-image-bucket clearfix"></div>\n    <div class="alert alert-danger alert-error"></div>\n    <[ if (isIMadeIt) { ]>\n    <div class="alert alert-info imadeit-alert">\n        Please include at least one image of what you made. Add images below.\n    </div>\n    <[ } ]>\n    <div class="actions">\n        <[ if (!isMobile) {]>\n            <p class="policy">We have a <b>be nice</b> policy.<br> Please be positive and constructive.</p>\n        <[}]>\n        <[ if (isEdit) {]>\n            <button class="btn cancel-btn">Cancel</button>\n        <[ } ]>\n        <button class="btn add-image-btn" <[ if (!typeSelected) {]> disabled<[}]>>\n            <img class="uploading-indicator" src="<< Ibles.staticUrl(\'img/ajax_loader_48px.gif\') >>"> Add Images\n        </button>\n        <button class="btn btn-yellow post-btn" <[ if (!typeSelected) {]> disabled<[}]>>\n            <img class="posting-indicator" src="<< Ibles.staticUrl(\'img/ajax_loader_48px.gif\') >>"> <[ if (!submitLabel) {]>Post<[ } else { ]><< submitLabel >><[ } ]>\n        </button>\n    </div>\n</div>\n',Ibles.JST["comment-hidden-replies-toggler"]='<a class="hidden-replies-link js-show-replies" role="button">\n    << replyCountlabel >><i class="icon-arrow-down"></i>\n</a>',Ibles.JST["comment-author-opts"]='<button class="pull-left edit-comment js-edit hide-mobile">Edit</button>\n<[ if (hasChildren){]>\n    <button class="pull-left delete-comment js-del-thread">Delete Thread</button>\n<[ } else { ]>\n    <button class="pull-left delete-comment js-del-comment">Delete</button>\n<[ } ]>\n',Ibles.JST["comment-modal"]='<div class="modal fade comment-modal << modalClass >>">\n    <div class="modal-dialog modal-sm">\n        <div class="modal-content">\n            <div class="modal-body">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>\n                <div class="js-gallery"></div>\n                <div class="primary-comment">\n                    <div class="js-primary-comment">\n                        <div class="loader">\n                            <img class="comment-modal-loader" src="<< Ibles.staticUrl(\'img/ajax_loader_48px.gif\') >>">\n                        </div>\n                    </div>\n                </div>\n                <div class="discussions js-replies">\n                    <div class="replies js-comments"></div>\n                </div>\n            </div>\n            <[ if (!hideNavigation) { ]>\n                <a href="javascript:void(0);" title="Next" class="js-next fancybox-nav fancybox-next"><span></span></a>\n                <a href="javascript:void(0);" title="Previous" class="js-prev fancybox-nav fancybox-prev"><span></span></a>\n            <[ } ]>\n        </div>\n    </div>\n</div>\n',Ibles.JST["comment-modal-gallery"]='<div class="scrollable-cards comment-modal-gallery <[ if (willScroll){]>will-scroll<[}]>">\n    <div class="scrollable-cards-inner" <[ if (willScroll) {]>style="height:<< galleryHeight >>px"<[}]>>\n        <[ _.each(imageFiles, function(file) { ]>\n            <div class="scrollable-card ">\n                <a href="<< file.getLargeAnimationUrl() >>" target="_blank"><img src="<< file.getOptimizedImageUrl({height: galleryHeight, frame: false}) >>"></a>\n            </div>\n        <[ }); ]>\n    </div>\n    <button class="control left-control hide-mobile" title="Previous"><i class="icon icon-arrow-left"></i></button>\n    <button class="control right-control hide-mobile <[ if (willScroll){]>active<[}]>" title="Next"><i class="icon icon-arrow-right"></i></button>\n</div>\n',Ibles.JST["comment-attached-file"]='<div class="file-info">\n    <a class="thumb-wrapper" href="<< attachmentUrl >>" download="<< name >>">\n        <span class="file-thumb"><img class="tiny-img" src="<< typeThumbnail >>" alt="<< name >>"></span>\n        <span class="title"><< name >></span>\n    </a>\n    <div class="file-actions">\n        <a href="<< attachmentUrl >>" download="<< name >>" class="btn pull-right">Download</a>\n    </div>\n</div>\n',Ibles.JST["comment-delete-prompt"]='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n    <h3 class="center"><< title >></h3>\n</div>\n<div class="modal-body clearfix">\n    <p class="center">Are you sure you want to delete it?</p>\n    <button class="btn btn-yellow btn-lg delete-btn pull-right"> Delete </button>\n    <button data-dismiss="modal" class="btn btn-lg pull-right cancel-btn"> Cancel </button>\n    <p class="center alert-error hide">Oops! There was a problem deleting.</p>\n</div>\n',function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(t){function n(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Object.create(e.prototype);for(var s in n)i[s]=n[s];return i.constructor=t,t.prototype=i,t}function i(e){e=e||{},this.defaultProtocol=e.defaultProtocol||l.defaultProtocol,this.events=e.events||l.events,this.format=e.format||l.format,this.formatHref=e.formatHref||l.formatHref,this.nl2br=e.nl2br||l.nl2br,this.tagName=e.tagName||l.tagName,this.target=e.target||l.target,this.validate=e.validate||l.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||l.attributes,this.className=e.className||e.linkClass||l.className;for(var t=e.ignoreTags||l.ignoreTags,n=0;n<t.length;n++)this.ignoreTags.push(t[n].toUpperCase())}function s(e){return e}function o(e,t,n,i){for(var s=0,o=e.length,a=t,r=[],l=void 0;s<o&&(l=a.next(e[s]));)a=l,s++;if(s>=o)return[];for(;s<o-1;)l=new u(i),r.push(l),a.on(e[s],l),a=l,s++;return l=new u(n),r.push(l),a.on(e[o-1],l),r}function a(e){return n(m,(function(e){e&&(this.v=e)}),e?{v:e}:{})}function r(e){return e instanceof p||e instanceof j}var l={defaultProtocol:"http",events:null,format:s,formatHref:s,nl2br:!1,tagName:"a",target:function(e,t){return"url"===t?"_blank":null},validate:!0,ignoreTags:[],attributes:null,className:"linkified"};i.prototype={resolve:function(e){var t=e.toHref(this.defaultProtocol);return{formatted:this.get("format",e.toString(),e),formattedHref:this.get("formatHref",t,e),tagName:this.get("tagName",t,e),className:this.get("className",t,e),target:this.get("target",t,e),events:this.getObject("events",t,e),attributes:this.getObject("attributes",t,e)}},check:function(e){return this.get("validate",e.toString(),e)},get:function(t,n,i){var s=this[t];if(!s)return s;switch(void 0===s?"undefined":e(s)){case"function":return s(n,i.type);case"object":var o=s[i.type]||l[t];return"function"==typeof o?o(n,i.type):o}return s},getObject:function(e,t,n){var i=this[e];return"function"==typeof i?i(t,n.type):i}};var c=Object.freeze({defaults:l,Options:i,contains:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}}),d=function(e){this.j=[],this.T=e||null};d.prototype={defaultTransition:!1,on:function(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)this.j.push([e[n],t]);return this}return this.j.push([e,t]),this},next:function(e){for(var t=0;t<this.j.length;t++){var n=this.j[t],i=n[0],s=n[1];if(this.test(e,i))return s}return this.defaultTransition},accepts:function(){return!!this.T},test:function(e,t){return e===t},emit:function(){return this.T}};var u=n(d,(function(e){this.j=[],this.T=e||null}),{test:function(e,t){return e===t||t instanceof RegExp&&t.test(e)}}),h=n(d,(function(e){this.j=[],this.T=e||null}),{jump:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.next(new e(""));return n===this.defaultTransition?(n=new this.constructor(t),this.on(e,n)):t&&(n.T=t),n},test:function(e,t){return e instanceof t}}),m=function(e){e&&(this.v=e)};m.prototype={toString:function(){return this.v+""}};var p=a(),f=a("@"),g=a(":"),b=a("."),v=a(),w=a(),y=a("\n"),I=a(),C=a("+"),x=a("#"),k=a(),S=a("mailto:"),T=a("?"),M=a("/"),A=a("_"),$=a(),j=a(),P=a(),_=a("{"),R=a("["),E=a("<"),O=a("("),U=a("}"),D=a("]"),N=a(">"),L=a(")"),F=a("&"),V=Object.freeze({Base:m,DOMAIN:p,AT:f,COLON:g,DOT:b,PUNCTUATION:v,LOCALHOST:w,NL:y,NUM:I,PLUS:C,POUND:x,QUERY:T,PROTOCOL:k,MAILTO:S,SLASH:M,UNDERSCORE:A,SYM:$,TLD:j,WS:P,OPENBRACE:_,OPENBRACKET:R,OPENANGLEBRACKET:E,OPENPAREN:O,CLOSEBRACE:U,CLOSEBRACKET:D,CLOSEANGLEBRACKET:N,CLOSEPAREN:L,AMPERSAND:F}),z="aaa|aarp|abb|abbott|abogado|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|af|afl|ag|agency|ai|aig|airforce|airtel|al|alibaba|alipay|allfinanz|alsace|am|amica|amsterdam|an|analytics|android|ao|apartments|app|apple|aq|aquarelle|ar|aramco|archi|army|arpa|arte|as|asia|associates|at|attorney|au|auction|audi|audio|author|auto|autos|avianca|aw|ax|axa|az|azure|ba|baidu|band|bank|bar|barcelona|barclaycard|barclays|bargains|bauhaus|bayern|bb|bbc|bbva|bcg|bcn|bd|be|beats|beer|bentley|berlin|best|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bom|bond|boo|book|boots|bosch|bostik|bot|boutique|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|camera|camp|cancerresearch|canon|capetown|capital|car|caravan|cards|care|career|careers|cars|cartier|casa|cash|casino|cat|catering|cba|cbn|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chloe|christmas|chrome|church|ci|cipriani|circle|cisco|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|date|dating|datsun|day|dclk|de|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|diamonds|diet|digital|direct|directory|discount|dj|dk|dm|dnp|do|docs|dog|doha|domains|download|drive|dubai|durban|dvag|dz|earth|eat|ec|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|erni|es|esq|estate|et|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|fage|fail|fairwinds|faith|family|fan|fans|farm|fashion|fast|feedback|ferrero|fi|film|final|finance|financial|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|florist|flowers|flsmidth|fly|fm|fo|foo|football|ford|forex|forsale|forum|foundation|fox|fr|fresenius|frl|frogans|frontier|fund|furniture|futbol|fyi|ga|gal|gallery|gallup|game|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|gold|goldpoint|golf|goo|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|group|gs|gt|gu|gucci|guge|guide|guitars|guru|gw|gy|hamburg|hangout|haus|hdfcbank|health|healthcare|help|helsinki|here|hermes|hiphop|hitachi|hiv|hk|hm|hn|hockey|holdings|holiday|homedepot|homes|honda|horse|host|hosting|hoteles|hotmail|house|how|hr|hsbc|ht|hu|hyundai|ibm|icbc|ice|icu|id|ie|ifm|iinet|il|im|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|international|investments|io|ipiranga|iq|ir|irish|is|iselect|ist|istanbul|it|itau|iwc|jaguar|java|jcb|je|jetzt|jewelry|jlc|jll|jm|jmp|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kitchen|kiwi|km|kn|koeln|komatsu|kp|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|lamborghini|lamer|lancaster|land|landrover|lanxess|lasalle|lat|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|legal|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|limited|limo|lincoln|linde|link|live|living|lixil|lk|loan|loans|local|locus|lol|london|lotte|lotto|love|lr|ls|lt|ltd|ltda|lu|lupin|luxe|luxury|lv|ly|ma|madrid|maif|maison|makeup|man|management|mango|market|marketing|markets|marriott|mba|mc|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|mg|mh|miami|microsoft|mil|mini|mk|ml|mm|mma|mn|mo|mobi|mobily|moda|moe|moi|mom|monash|money|montblanc|mormon|mortgage|moscow|motorcycles|mov|movie|movistar|mp|mq|mr|ms|mt|mtn|mtpc|mtr|mu|museum|mutuelle|mv|mw|mx|my|mz|na|nadex|nagoya|name|natura|navy|nc|ne|nec|net|netbank|network|neustar|new|news|nexus|nf|ng|ngo|nhk|ni|nico|nikon|ninja|nissan|nl|no|nokia|norton|nowruz|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|office|okinawa|om|omega|one|ong|onl|online|ooo|oracle|orange|org|organic|origins|osaka|otsuka|ovh|pa|page|pamperedchef|panerai|paris|pars|partners|parts|party|passagens|pe|pet|pf|pg|ph|pharmacy|philips|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pohl|poker|porn|post|pr|praxi|press|pro|prod|productions|prof|promo|properties|property|protection|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|racing|re|read|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|ricoh|rio|rip|ro|rocher|rocks|rodeo|room|rs|rsvp|ru|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|saxo|sb|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scor|scot|sd|se|seat|security|seek|select|sener|services|seven|sew|sex|sexy|sfr|sg|sh|sharp|shell|shia|shiksha|shoes|show|shriram|si|singles|site|sj|sk|ski|skin|sky|skype|sl|sm|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|st|stada|star|starhub|statefarm|statoil|stc|stcgroup|stockholm|storage|store|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|taobao|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|team|tech|technology|tel|telecity|telefonica|temasek|tennis|tf|tg|th|thd|theater|theatre|tickets|tienda|tiffany|tips|tires|tirol|tj|tk|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tp|tr|trade|trading|training|travel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubs|ug|uk|unicom|university|uno|uol|us|uy|uz|va|vacations|vana|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|viking|villas|vin|vip|virgin|vision|vista|vistaprint|viva|vlaanderen|vn|vodka|volkswagen|vote|voting|voto|voyage|vu|vuelos|wales|walter|wang|wanggou|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|wme|wolterskluwer|work|works|world|ws|wtc|wtf|xbox|xerox|xin|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|youtube|yt|za|zara|zero|zip|zm|zone|zuerich|zw".split("|"),B="0123456789".split(""),q="0123456789abcdefghijklmnopqrstuvwxyz".split(""),H=[" ","\f","\r","\t","\v","","",""],G=[],J=function(e){return new u(e)},W=J(),Q=J(I),K=J(p),Y=J(),Z=J(P);W.on("@",J(f)).on(".",J(b)).on("+",J(C)).on("#",J(x)).on("?",J(T)).on("/",J(M)).on("_",J(A)).on(":",J(g)).on("{",J(_)).on("[",J(R)).on("<",J(E)).on("(",J(O)).on("}",J(U)).on("]",J(D)).on(">",J(N)).on(")",J(L)).on("&",J(F)).on([",",";","!",'"',"'"],J(v)),W.on("\n",J(y)).on(H,Z),Z.on(H,Z);for(var X=0;X<z.length;X++){var ee=o(z[X],W,j,p);G.push.apply(G,ee)}var te=o("file",W,p,p),ne=o("ftp",W,p,p),ie=o("http",W,p,p),se=o("mailto",W,p,p);G.push.apply(G,te),G.push.apply(G,ne),G.push.apply(G,ie);var oe=te.pop(),ae=ne.pop(),re=ie.pop(),le=se.pop(),ce=J(p),de=J(k),ue=J(S);ae.on("s",ce).on(":",de),re.on("s",ce).on(":",de),G.push(ce),oe.on(":",de),ce.on(":",de),le.on(":",ue);var he=o("localhost",W,w,p);G.push.apply(G,he),W.on(B,Q),Q.on("-",Y).on(B,Q).on(q,K),K.on("-",Y).on(q,K);for(var me=0;me<G.length;me++)G[me].on("-",Y).on(q,K);Y.on("-",Y).on(B,K).on(q,K),W.defaultTransition=J($);var pe=function(e){for(var t=e.replace(/[A-Z]/g,(function(e){return e.toLowerCase()})),n=e.length,i=[],s=0;s<n;){for(var o=W,a=null,r=0,l=null,c=-1;s<n&&(a=o.next(t[s]));)null,(o=a).accepts()?(c=0,l=o):c>=0&&c++,r++,s++;if(!(c<0)){s-=c,r-=c;var d=l.emit();i.push(new d(e.substr(s-r,r)))}}return i},fe=W,ge=Object.freeze({State:u,TOKENS:V,run:pe,start:fe}),be=function(e){e&&(this.v=e)};be.prototype={type:"token",isLink:!1,toString:function(){for(var e=[],t=0;t<this.v.length;t++)e.push(this.v[t].toString());return e.join("")},toHref:function(){return this.toString()},toObject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(e)}}};var ve=n(be,(function(e){e&&(this.v=e)}),{type:"email",isLink:!0}),we=n(be,(function(e){e&&(this.v=e)}),{type:"email",isLink:!0,toHref:function(){return this.v,"mailto:"+this.toString()}}),ye=n(be,(function(e){e&&(this.v=e)}),{type:"text"}),Ie=n(be,(function(e){e&&(this.v=e)}),{type:"nl"}),Ce=n(be,(function(e){e&&(this.v=e)}),{type:"url",isLink:!0,toHref:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http",t=!1,n=!1,i=this.v,s=[],o=0;i[o]instanceof k;)t=!0,s.push(i[o].toString().toLowerCase()),o++;for(;i[o]instanceof M;)n=!0,s.push(i[o].toString()),o++;for(;r(i[o]);)s.push(i[o].toString().toLowerCase()),o++;for(;o<i.length;o++)s.push(i[o].toString());return s=s.join(""),t||n||(s=e+"://"+s),s},hasProtocol:function(){return this.v[0]instanceof k}}),xe=Object.freeze({Base:be,MAILTOEMAIL:ve,EMAIL:we,NL:Ie,TEXT:ye,URL:Ce}),ke=function(e){return new h(e)},Se=ke(),Te=ke(),Me=ke(),Ae=ke(),$e=ke(),je=ke(),Pe=ke(),_e=ke(Ce),Re=ke(),Ee=ke(Ce),Oe=ke(Ce),Ue=ke(),De=ke(),Ne=ke(),Le=ke(),Fe=ke(),Ve=ke(Ce),ze=ke(Ce),Be=ke(Ce),qe=ke(Ce),He=ke(),Ge=ke(),Je=ke(),We=ke(),Qe=ke(),Ke=ke(),Ye=ke(we),Ze=ke(),Xe=ke(we),et=ke(ve),tt=ke(),nt=ke(),it=ke(),st=ke(),ot=ke(Ie);Se.on(y,ot).on(k,Te).on(S,Me).on(M,Ae),Te.on(M,Ae),Ae.on(M,$e),Se.on(j,je).on(p,je).on(w,_e).on(I,je),$e.on(j,Oe).on(p,Oe).on(I,Oe).on(w,Oe),je.on(b,Pe),Qe.on(b,Ke),Pe.on(j,_e).on(p,je).on(I,je).on(w,je),Ke.on(j,Ye).on(p,Qe).on(I,Qe).on(w,Qe),_e.on(b,Pe),Ye.on(b,Ke),_e.on(g,Re).on(M,Oe),Re.on(I,Ee),Ee.on(M,Oe),Ye.on(g,Ze),Ze.on(I,Xe);var at=[p,f,w,I,C,x,k,M,j,A,$,F],rt=[g,b,T,v,U,D,N,L,_,R,E,O];Oe.on(_,De).on(R,Ne).on(E,Le).on(O,Fe),Ue.on(_,De).on(R,Ne).on(E,Le).on(O,Fe),De.on(U,Oe),Ne.on(D,Oe),Le.on(N,Oe),Fe.on(L,Oe),Ve.on(U,Oe),ze.on(D,Oe),Be.on(N,Oe),qe.on(L,Oe),He.on(U,Oe),Ge.on(D,Oe),Je.on(N,Oe),We.on(L,Oe),De.on(at,Ve),Ne.on(at,ze),Le.on(at,Be),Fe.on(at,qe),De.on(rt,He),Ne.on(rt,Ge),Le.on(rt,Je),Fe.on(rt,We),Ve.on(at,Ve),ze.on(at,ze),Be.on(at,Be),qe.on(at,qe),Ve.on(rt,Ve),ze.on(rt,ze),Be.on(rt,Be),qe.on(rt,qe),He.on(at,Ve),Ge.on(at,ze),Je.on(at,Be),We.on(at,qe),He.on(rt,He),Ge.on(rt,Ge),Je.on(rt,Je),We.on(rt,We),Oe.on(at,Oe),Ue.on(at,Oe),Oe.on(rt,Ue),Ue.on(rt,Ue),Me.on(j,et).on(p,et).on(I,et).on(w,et),et.on(at,et).on(rt,tt),tt.on(at,et).on(rt,tt);var lt=[p,I,C,x,T,A,$,F,j];je.on(lt,nt).on(f,it),_e.on(lt,nt).on(f,it),Pe.on(lt,nt),nt.on(lt,nt).on(f,it).on(b,st),st.on(lt,nt),it.on(j,Qe).on(p,Qe).on(w,Ye);var ct=function(e){for(var t=e.length,n=0,i=[],s=[];n<t;){for(var o=Se,a=null,r=null,l=0,c=null,d=-1;n<t&&!(a=o.next(e[n]));)s.push(e[n++]);for(;n<t&&(r=a||o.next(e[n]));)a=null,(o=r).accepts()?(d=0,c=o):d>=0&&d++,n++,l++;if(d<0)for(var u=n-l;u<n;u++)s.push(e[u]);else{s.length>0&&(i.push(new ye(s)),s=[]),n-=d,l-=d;var h=c.emit();i.push(new h(e.slice(n-l,n)))}}return s.length>0&&i.push(new ye(s)),i},dt=Object.freeze({State:h,TOKENS:xe,run:ct,start:Se});Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var ut=function(e){return ct(pe(e))};t.find=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=ut(e),i=[],s=0;s<n.length;s++){var o=n[s];!o.isLink||t&&o.type!==t||i.push(o.toObject())}return i},t.inherits=n,t.options=c,t.parser=dt,t.scanner=ge,t.test=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=ut(e);return 1===n.length&&n[0].isLink&&(!t||n[0].type===t)},t.tokenize=ut}(self.linkify=self.linkify||{})}(),function(e,t){var n=function(e){function t(e){this.a=e}function n(e){return p.test(e)}function i(e){return f.test(e)}function s(e,t){this.b=e,this.c=t,this.d=null,this.input=null,this.e=-1,this.f=-1,this.g=-1,this.h=-1,this.i=-1,this.j()}function o(e,t){this.k=null,this.startLine=1,this.startColumn=0,this.options=t||{},this.tokenizer=new s(this,e)}function a(t,n){for(var i=e.tokenize(t),s=[],o=0;o<i.length;o++){var a=i[o];if("nl"===a.type&&n.nl2br)s.push({type:y,tagName:"br",attributes:[],l:!0});else if(a.isLink&&n.check(a)){var r=n.resolve(a),l=(r.href,r.formatted),c=r.formattedHref,d=r.tagName,u=r.className,h=r.target,m=r.attributes,p=[["href",c]];for(var f in u&&p.push(["class",u]),h&&p.push(["target",h]),m)p.push([f,m[f]]);s.push({type:y,tagName:d,attributes:p,l:!1}),s.push({type:C,chars:l}),s.push({type:I,tagName:d})}else s.push({type:C,chars:a.toString()})}return s}function r(e,t,n,i){for(var s=1;n<t.length&&s>0;){var o=t[n];o.type===y&&o.tagName.toUpperCase()===e?s++:o.type===I&&o.tagName.toUpperCase()===e&&s--,i.push(o),n++}return i}function l(e){return e.replace(/"/g,"&quot;")}function c(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],s=i[0],o=i[1];t.push(s+'="'+l(o)+'"')}return t}var d={m:""},u=/^#[xX]([A-Fa-f0-9]+)$/,h=/^#([0-9]+)$/,m=/^([A-Za-z0-9]+)$/;t.prototype.parse=function(e){if(e){var t=e.match(u);return t?"&#x"+t[1]+";":(t=e.match(h))?"&#"+t[1]+";":(t=e.match(m))?this.a[t[1]]||"&"+t[1]+";":void 0}};var p=/[\t\n\f ]/,f=/[A-Za-z]/,g=/\r\n?/g;s.prototype={j:function(){this.d="beforeData",this.input="",this.e=0,this.f=1,this.g=0,this.h=-1,this.i=-1,this.b.j()},tokenize:function(e){this.j(),this.tokenizePart(e),this.tokenizeEOF()},tokenizePart:function(e){for(this.input+=function(e){return e.replace(g,"\n")}(e);this.e<this.input.length;)this.n[this.d].call(this)},tokenizeEOF:function(){this.o()},o:function(){"data"===this.d&&(this.b.p(),this.d="beforeData")},q:function(){return this.input.charAt(this.e)},r:function(){var e=this.q();return this.e++,"\n"===e?(this.f++,this.g=0):this.g++,e},s:function(){var e=this.input.indexOf(";",this.e);if(-1!==e){var t=this.input.slice(this.e,e),n=this.c.parse(t);if(n){for(var i=t.length;i;)this.r(),i--;return this.r(),n}}},t:function(){this.h=this.f,this.i=this.g,this.b.tagOpen&&this.b.tagOpen()},n:{beforeData:function(){"<"===this.q()?(this.d="tagOpen",this.t(),this.r()):(this.d="data",this.b.u())},data:function(){var e=this.q();"<"===e?(this.b.p(),this.d="tagOpen",this.t(),this.r()):"&"===e?(this.r(),this.b.v(this.s()||"&")):(this.r(),this.b.v(e))},tagOpen:function(){var e=this.r();"!"===e?this.d="markupDeclaration":"/"===e?this.d="endTagOpen":i(e)&&(this.d="tagName",this.b.w(),this.b.x(e.toLowerCase()))},markupDeclaration:function(){"-"===this.r()&&"-"===this.input.charAt(this.e)&&(this.r(),this.d="commentStart",this.b.y())},commentStart:function(){var e=this.r();"-"===e?this.d="commentStartDash":">"===e?(this.b.z(),this.d="beforeData"):(this.b.A(e),this.d="comment")},commentStartDash:function(){var e=this.r();"-"===e?this.d="commentEnd":">"===e?(this.b.z(),this.d="beforeData"):(this.b.A("-"),this.d="comment")},comment:function(){var e=this.r();"-"===e?this.d="commentEndDash":this.b.A(e)},commentEndDash:function(){var e=this.r();"-"===e?this.d="commentEnd":(this.b.A("-"+e),this.d="comment")},commentEnd:function(){var e=this.r();">"===e?(this.b.z(),this.d="beforeData"):(this.b.A("--"+e),this.d="comment")},tagName:function(){var e=this.r();n(e)?this.d="beforeAttributeName":"/"===e?this.d="selfClosingStartTag":">"===e?(this.b.B(),this.d="beforeData"):this.b.x(e)},beforeAttributeName:function(){var e=this.q();return n(e)?void this.r():void("/"===e?(this.d="selfClosingStartTag",this.r()):">"===e?(this.r(),this.b.B(),this.d="beforeData"):(this.d="attributeName",this.b.C(),this.r(),this.b.D(e)))},attributeName:function(){var e=this.q();n(e)?(this.d="afterAttributeName",this.r()):"/"===e?(this.b.F(!1),this.b.G(),this.r(),this.d="selfClosingStartTag"):"="===e?(this.d="beforeAttributeValue",this.r()):">"===e?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.r(),this.b.D(e))},afterAttributeName:function(){var e=this.q();return n(e)?void this.r():void("/"===e?(this.b.F(!1),this.b.G(),this.r(),this.d="selfClosingStartTag"):"="===e?(this.r(),this.d="beforeAttributeValue"):">"===e?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.b.F(!1),this.b.G(),this.r(),this.d="attributeName",this.b.C(),this.b.D(e)))},beforeAttributeValue:function(){var e=this.q();n(e)?this.r():'"'===e?(this.d="attributeValueDoubleQuoted",this.b.F(!0),this.r()):"'"===e?(this.d="attributeValueSingleQuoted",this.b.F(!0),this.r()):">"===e?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.d="attributeValueUnquoted",this.b.F(!1),this.r(),this.b.H(e))},attributeValueDoubleQuoted:function(){var e=this.r();'"'===e?(this.b.G(),this.d="afterAttributeValueQuoted"):"&"===e?this.b.H(this.s('"')||"&"):this.b.H(e)},attributeValueSingleQuoted:function(){var e=this.r();"'"===e?(this.b.G(),this.d="afterAttributeValueQuoted"):"&"===e?this.b.H(this.s("'")||"&"):this.b.H(e)},attributeValueUnquoted:function(){var e=this.q();n(e)?(this.b.G(),this.r(),this.d="beforeAttributeName"):"&"===e?(this.r(),this.b.H(this.s(">")||"&")):">"===e?(this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.r(),this.b.H(e))},afterAttributeValueQuoted:function(){var e=this.q();n(e)?(this.r(),this.d="beforeAttributeName"):"/"===e?(this.r(),this.d="selfClosingStartTag"):">"===e?(this.r(),this.b.B(),this.d="beforeData"):this.d="beforeAttributeName"},selfClosingStartTag:function(){">"===this.q()?(this.r(),this.b.I(),this.b.B(),this.d="beforeData"):this.d="beforeAttributeName"},endTagOpen:function(){var e=this.r();i(e)&&(this.d="tagName",this.b.J(),this.b.x(e.toLowerCase()))}}},o.prototype={tokenize:function(e){return this.K=[],this.tokenizer.tokenize(e),this.K},tokenizePart:function(e){return this.K=[],this.tokenizer.tokenizePart(e),this.K},tokenizeEOF:function(){return this.K=[],this.tokenizer.tokenizeEOF(),this.K[0]},j:function(){this.k=null,this.startLine=1,this.startColumn=0},L:function(){this.options.M&&(this.k.M={start:{f:this.startLine,g:this.startColumn},N:{f:this.tokenizer.f,g:this.tokenizer.g}}),this.startLine=this.tokenizer.f,this.startColumn=this.tokenizer.g},u:function(){this.k={type:"Chars",chars:""},this.K.push(this.k)},v:function(e){this.k.chars+=e},p:function(){this.L()},y:function(){this.k={type:"Comment",chars:""},this.K.push(this.k)},A:function(e){this.k.chars+=e},z:function(){this.L()},w:function(){this.k={type:"StartTag",tagName:"",attributes:[],l:!1},this.K.push(this.k)},J:function(){this.k={type:"EndTag",tagName:""},this.K.push(this.k)},B:function(){this.L()},I:function(){this.k.l=!0},x:function(e){this.k.tagName+=e},C:function(){this._currentAttribute=["","",null],this.k.attributes.push(this._currentAttribute)},D:function(e){this._currentAttribute[0]+=e},F:function(e){this._currentAttribute[2]=e},H:function(e){this._currentAttribute[1]=this._currentAttribute[1]||"",this._currentAttribute[1]+=e},G:function(){}};var b={HTML5NamedCharRefs:d,EntityParser:t,EventedTokenizer:s,Tokenizer:o,tokenize:function(e,n){return new o(new t(d),n).tokenize(e)}},v=e.options,w=v.Options,y="StartTag",I="EndTag",C="Chars",x="Comment";return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=b.tokenize(e),s=[],o=[];for(n=new w(n),t=0;t<i.length;t++){var l=i[t];if(l.type!==y)if(l.type===C){var d=a(l.chars,n);s.push.apply(s,d)}else s.push(l);else{s.push(l);var u=l.tagName.toUpperCase(),h="A"===u||v.contains(n.ignoreTags,u);if(!h)continue;var m=s.length;r(u,i,++t,s),t+=s.length-m-1}}for(t=0;t<s.length;t++){var p=s[t];switch(p.type){case y:var f="<"+p.tagName;if(p.attributes.length>0){var g=c(p.attributes);f+=" "+g.join(" ")}f+=">",o.push(f);break;case I:o.push("</"+p.tagName+">");break;case C:o.push(p.chars);break;case x:o.push("\x3c!--"+p.chars+"--\x3e")}}return o.join("")}}(linkify);e.linkifyHtml=n}(window),Ibles.package("Ibles.views"),Ibles.views.RedactorTextAreaView=Backbone.View.extend({initialize:function(e){_.bindAll(this,"redactorLoaded","sync"),e=e||{},this.enableHtml=e.enableHtml||!1,this.textArea=e.textArea||this.$(".redactor-textarea"),this.toolTip=e.tooltip||this.$(".redactor-tooltip"),this.redactorOptions=e.redactorOptions||{},this.addAirOptions(),this.enableHtml&&this.addHtmlOptions(),this.redactorLoadedCallback=e.redactorLoadedCallback,this.addRedactorAirMode()},addAirOptions:function(){this.redactorOptions=_.extend(this.redactorOptions,{air:!0,plugins:["instructables","instructablesAir"],airButtons:["bold","italic","heading","link_ibles","quote"],convertVideoLinks:!0,convertLinks:!0,buttonsCustom:{link_ibles:{title:"Link",callback:function(e){this.ibles_makeLink(e)}},heading:{title:"Heading",callback:function(e){this.ibles_makeheader(e)}},quote:{title:"Blockquote",func:"formatQuote"}}})},addHtmlOptions:function(){this.redactorOptions=_.extend(this.redactorOptions,{airButtons:["bold","italic","heading","link_ibles","quote","html"],convertDivs:!1,deniedTags:[],syncBeforeCallback:function(e){return!0===this.editedCode?this.get():e},textareaKeydownCallback:function(){this.editedCode=!0},keydownCallback:function(){this.editedCode=!1}})},addRedactorAirMode:function(){var e=this,t=Ibles.pageContext.commitInfo&&Ibles.pageContext.commitInfo.git_hash||"",n=_.map(["js/libs/redactor916/redactor/redactor.css","js/libs/redactorInstructables/airmode.css","js/libs/redactor916/redactor/redactor.min.js","js/RedactorAirPlugin.js"],(function(e){return`${Ibles.pageContext.staticRoot}${e}?cb=${t}`}));head.load(n,(function(){e.textArea.redactor(e.redactorOptions||{}),e.redactorLoaded()}))},redactorLoaded:function(){this.trigger("redactorLoaded"),"function"==typeof this.redactorLoadedCallback&&this.redactorLoadedCallback()},sync:function(){return this.textArea.redactor("sync"),this.textArea.redactor("get")},hideToolTip:function(){this.toolTip.tooltip("hide"),this.$(".redactor_redactor-textarea").off("click")},reset:function(){this.$(".redactor_editor").empty(),this.textArea.val("")}}),Ibles.package("Ibles.views"),Ibles.views.ScrollableCardsView=Backbone.View.fullExtend({events:{"click .left-control":"scrollBack","click .right-control":"scrollForward"},initialize:function(){_.bindAll(this,"scroll"),this.$scrollable=this.$(".scrollable-cards-inner"),this.$scrollable.scroll(_.debounce(this.scroll,250))},scrollBack:function(e){if(e.preventDefault(),$(e.currentTarget).hasClass("active")){var t=this.$(".carousel-items").scrollLeft();this.$scrollable.animate({scrollLeft:t-this.$scrollable.width()},800)}},scrollForward:function(e){if(e.preventDefault(),$(e.currentTarget).hasClass("active")){var t=this.$scrollable.scrollLeft();this.$scrollable.animate({scrollLeft:t+this.$scrollable.width()},800)}},scroll:function(){var e=this.$scrollable,t=this.$(".right-control"),n=this.$(".left-control"),i=e.children(".scrollable-card").last(),s=e.width();e.scrollLeft()>0?n.addClass("active"):n.removeClass("active"),i.position().left+i.width()<=s?t.removeClass("active"):t.addClass("active")}}),Ibles.package("Ibles.models"),Ibles.models.CommentModel=Backbone.Model.extend({defaults:function(){return{id:null,instructableId:null,topicId:null,author:Ibles.session.get("screenName"),authorId:Ibles.session.get("id"),authorUrl:null,avatar:Ibles.session.getAvatarUrl(),avatarDownload:null,files:[],fileSet:new Ibles.collections.FileCollection,IMadeIt:!1,inReplyTo:null,replyAuthor:null,quarantine:!1,limbo:!1,status:null,commentable:null,commentableId:null,body:"",stepId:null,stepAnchorId:null,stepIndexLabel:null,designations:[],voted:!1,rating:0,sticky:!1,visible:!0,lastVisibleInThread:!1,indexInReplyThread:null,numRepliesFromMe:null}},designations:["tip","topic","review","answer","bestAnswer","comment","question"],initialize:function(){_.bindAll(this,"onSaveError","onSaveSuccess","onEditSuccess","onDeleteSuccess"),_.isUndefined(this.get("publishDate"))||this.set({commentTime:dayjs(Ibles.addServerTimeZone(this.get("publishDate"))).fromNow()}),_.isEmpty(this.get("authorUrl"))&&this.set({authorUrl:Ibles.reverseUrls.memberUrl(this.get("author"))}),_.isEmpty(this.get("files"))||this.get("fileSet").add(this.get("files")),"DELETED"===this.get("status")&&this.setDeletedBody(),window.linkify&&(window.linkify.options.defaults.className=null),this.listenTo(this,"change:body",(function(){this.set({body:linkifyHtml(this.get("body"))},{silent:!0})})),this.listenTo(this,"change:designations",(function(){this.updateDesignatedProps()})),this.updateDesignatedProps()},updateDesignatedProps:function(){this.set({designatedQuestion:this.isQuestion(),designatedTip:this.isTip(),designatedAnswer:this.isAnswer(),designatedBestAnswer:this.isBestAnswer(),designatedComment:this.isDesignatedComment()})},isReply:function(){return!!this.get("inReplyTo")},isVisible:function(){return this.get("visible")},hasDesignation:function(){return!_.isEmpty(this.get("designations"))},hasChildren:function(){var e=this,t=e.collection,n=t&&t.at(t.indexOf(e)+1);return n&&n.get("inReplyTo")==e.get("id")},isDesignated:function(e){return _.contains(this.get("designations"),e)},isQuestion:function(){return this.isDesignated("question")},isAnswer:function(){return this.isDesignated("answer")},isBestAnswer:function(){return this.isDesignated("bestAnswer")},isTip:function(){return this.isDesignated("tip")},isDesignatedComment:function(){return this.isDesignated("comment")},isIMadeIt:function(){return this.get("IMadeIt")},voted:function(){return!!this.get("voted")},votes:function(){return this.get("rating")},votableByCurrentUser:function(){var e=Ibles.session,t=e.get("screenName"),n=this.get("author");return e.authenticated()&&t!=n},currentUserIsOwner:function(){return this.currentUserIsAuthor()},currentUserIsAuthor:function(){var e=Ibles.session,t=e.get("screenName"),n=this.get("author");return e.authenticated()&&t==n},authorIsProjectOwner:function(e){var t=e.get("author");return _.isObject(t)&&(t=t.screenName),this.get("author")===t},getAuthorAvatarUrl:function(){var e=this.get("avatarDownload");return e?Ibles.fileFromOriginalUrl(e,{isUserFile:!0}).getTinyUrl():Ibles.session.getAvatarUrl()},setDesignations:function(e,t){var n={commentId:this.get("id"),designations:e},i=this;return t&&(n.threadDesignations=t),Ibles.API.jsonPostRequest("setDesignations",n).done((function(){i.set({designations:e})}))},setDeletedBody:function(){this.set({body:Ibles.T("(removed by author or community request)")})},setReplyAuthor:function(){var e=this,t=e.collection;if(t&&!_.isUndefined(e.get("inReplyTo"))&&_.isNull(e.get("replyAuthor"))){var n=t.get(e.get("inReplyTo"));_.isEmpty(n)||e.set({replyAuthor:n.get("author")})}},getImagesParam:function(){var e=this.get("fileSet"),t=[];return e.isEmpty()||(t=_.isFunction(e.idArray)?e.idArray():e.map((function(e){return{id:e.get("id")}}))),t},editRequest:function(){var e=this,t={id:e.get("id"),body:e.get("body"),images:e.getImagesParam()};return Ibles.API.jsonPostRequest("editComment",t,{success:e.onEditSuccess,error:e.onSaveError})},onEditSuccess:function(){var e=this;e.trigger("change"),e.trigger("comment.postSuccess",e)},save:function(){var e=this,t=_.omit(_.pick(e.toJSON(),"instructableId","topicId","author","IMadeIt","body","inReplyTo","stepId","designations"),_.isNull);return t.images=e.getImagesParam(),Ibles.API.jsonPostRequest("addComment",t,{success:e.onSaveSuccess,error:e.onSaveError})},onSaveSuccess:function(e){var t=this,n=t.collection;if(t.set({id:e.id,commentTime:"a few seconds ago",publishDate:dayjs().fromNow()}),t.trigger("comment.postSuccess",t),_.isUndefined(t.get("inReplyTo")))n.add(t,{at:0});else{var i=n.indexOf(n.findWhere({id:t.get("inReplyTo")}));n.add(t,{at:i+1}),n.dirtyTree=!0}},onSaveError:function(e){var t;if(e&&e.responseJSON&&(e=e.responseJSON),e&&e.validationErrors){var n=Object.keys(e.validationErrors);t=n.length>1?Ibles.text.errors.incompleteFormError:e.validationErrors[n[0]]}else t=Ibles.extractErrorMessage(e,Ibles.text.errors.somethingWentWrong);this.trigger("comment.postError",t)},toggleVote:function(){var e=this,t={commentId:e.get("id")},n=e.get("voted");return t.value=n?0:1,Ibles.API.jsonPostRequest("addRating",t,{success:function(){var t=e.get("rating");n=!n,e.set({voted:n,rating:n?++t:--t})}})},toggleBestAnswer:function(){var e=this,t=e.isBestAnswer()?["answer"]:["answer","bestAnswer"];return Ibles.API.jsonPostRequest("setDesignations",{commentId:e.get("id"),designations:t}).done((function(){e.set({designations:t})}))},deleteComment:function(){return Ibles.API.postRequest("deleteComment",{id:this.get("id")},{success:this.onDeleteSuccess})},onDeleteSuccess:function(){var e=this;e.collection.getChildrenArray(e).length>0?e.setDeletedBody():e.collection.remove(e)},deleteThread:function(){var e=this;return Ibles.API.postRequest("deleteThread",{id:this.get("id")},{success:function(){e.collection.deleteThread(e)}})},setIMadeIt:function(e){var t={id:this.get("id"),value:e};return $.ajax({url:"/json-api/setIMadeIt",dataType:"json",type:"POST",data:t})},flagComment:function(e){var t={id:this.get("id"),flag:e};return Ibles.API.postRequest("setFlag",t)},limbo:function(){var e=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),status:"LIMBO"}).done((function(){e.set({limbo:!0,quarantined:!1,status:"LIMBO"})}))},quarantine:function(){var e=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),status:"QUARANTINED"}).done((function(){e.set({quarantine:!0,limbo:!1,status:"QUARANTINED"})}))},publish:function(){var e=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),status:"PUBLISHED"}).done((function(){e.set({limbo:!1,quarantine:!1,status:"PUBLISHED"})}))},toggleStickyComment:function(e){var t=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),sticky:e}).done((function(){t.set({sticky:e})}))},toggleApproval:function(e){var t=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),approved:e}).done((function(){t.set({approved:e})}))},cloneWithoutUserSuppliedData:function(){var e=this.clone();return e.set({id:null,fileSet:new Ibles.collections.FileCollection,IMadeIt:!1,body:""}),e},toJSON:function(){var e=this;return _.extend(_.clone(e.attributes),{isTip:e.isTip(),isQuestion:e.isQuestion(),isAnswer:e.isAnswer(),isBestAnswer:e.isBestAnswer(),isReply:e.isReply(),avatar:e.getAuthorAvatarUrl()})}}),function(e){e.package("Ibles.collections"),e.collections.CommentCollection=Backbone.Collection.extend({model:e.models.CommentModel,dirtyTree:!1,apiEndPoint:"getComments",defaultFetchParams:{offset:0,limit:50,sort:"RECENT"},fetchOptions:["limit","offset","sort","instructableId","topicId","commentId","designation","IMadeIt","includeQuarantine"],additionOptions:["modelOptions","ratingOptions","numVisibleReplies","fetchRatings"],initialize:function(t,n){var i=n||{},s=this.fetchOptions;this.options=_.pick(i,s.concat(this.additionOptions)),this.fetchParams=_.extend(_.clone(this.defaultFetchParams),_.omit(_.pick(i,s,_.isUndefined))),this.modelProps=_.pick(i,i.modelOptions),i.fetchRatings&&e.session.isEmailVerified()&&(this.userRatingsPromise=this.fetchUserRatings())},deleteThread:function(e){var t=this.getChildrenArray(e),n=this.getParents(e);this.remove(t),this.remove(e),this.remove(n)},getLastThreadInfo:function(){var e=this,t=e.length,n=e.reloadingTree||!t,i=n?-1:_.findLastIndex(e.models,(function(e){return!e.get("inReplyTo")})),s=-1!==(s=n?-1:_.findLastIndex(e.models.slice(i),(function(e){return e.get("lastVisibleInThread")})))?s+i:-1;return{lastComment:n?null:e.models[t-1],lastVisibleInThread:s>=0?e.at(s):null,repliesCount:n||-1===i?0:t-i-1}},parseComments:function(e){var t=this,n=t.options.numVisibleReplies,i=_.isNumber(n),s=i?t.getLastThreadInfo():{},o=s.lastVisibleInThread,a=s.lastComment,r=s.repliesCount,l=e.comments,c=t.userRatingsPromise;return l.forEach((function(e){_.extend(e,this.modelProps),_.isUndefined(e.author)&&(e.author=null,e.authorUrl="/"),c&&c.done((function(t){e.voted=!!t[e.id]})),i&&(_.extend(e,{visible:!0,lastVisibleInThread:!1}),e.inReplyTo?(r+=1)>n&&(e.visible=!1,a&&t.isVisible(a)&&(t.setLastVisibleInThread(a,r),o=a)):(o&&(t.setNumberOfRepliesFromComment(o,r),o=null),r=0)),a=e}),this),i&&o&&t.setNumberOfRepliesFromComment(o,r),l},isVisible:function(e){return e.visible||e.cid&&e.get("visible")},setLastVisibleInThread:function(e,t){var n=t-1;e.cid?e.set({lastVisibleInThread:!0,indexInReplyThread:n},{silent:!0}):(e.lastVisibleInThread=!0,e.indexInReplyThread=n)},setNumberOfRepliesFromComment:function(e,t){var n;e.cid?(n=e.get("inReplyTo")?t-1-e.get("indexInReplyThread"):t,e.set({numRepliesFromMe:n})):(n=e.inReplyTo?t-1-e.indexInReplyThread:t,e.numRepliesFromMe=n)},fetch:function(e){var t=this;return this.dirtyTree?this.reloadCommentTree():this.fetchRequest(_.extend({offset:this.fetchParams.offset+this.length},e),(function(e){t.add(e),e.length<t.fetchParams.limit&&t.trigger("noMoreComments")}))},fetchRequest:function(t,n){var i=this,s=i.fetchParams,o=i.userRatingsPromise,a=i.apiEndPoint,r=function(){return e.API.getRequest(a,_.extend({},s,t),{success:function(e){n(i.parseComments(e))}})};return o?o.then(r):r()},reloadCommentTree:function(){var e=this,t=this.length+this.fetchParams.limit;return this.reloadingTree=!0,this.dirtyTree=!1,this.fetchRequest({offset:0,limit:t},(function(n){e.reset(n),n.length<t&&e.trigger("noMoreComments"),e.reloadingTree=!1}))},getParents:function(e){var t=this,n=[],i=function(e){var s=e.get("inReplyTo");if(_.isUndefined(s))return n;n.push(s),_.isUndefined(t.get(s))||i(t.get(s))};return i(e)},getChildrenArray:function(e){var t=this,n=[],i=function(e){var s=t.where({inReplyTo:e.get("id")});s.length>0&&(n=n.concat(_.pluck(s,"id")),_.each(s,i))};return i(e),n},getRatingsParams:function(){var t=this.options;return _.extend({screenName:e.session.get("screenName")},_.pick(t,t.ratingOptions))},fetchUserRatings:function(){var t,n,i,s=e.commentRatingsPromises,o=this.getRatingsParams();return _.isUndefined(s)&&(e.commentRatingsPromises=s={}),i=s[n=_.flatten(_.pairs(o)).join("-")],_.isEmpty(i)?(t=$.Deferred(),e.API.getRequest("getRatings",o).then((function(e){var n={};_.each(e.ratings,(function(e){n[e.id]=!0})),t.resolve(n)})),s[n]=t.promise()):i}})}(Ibles),function(e,t,n){n.package("Ibles.views"),n.views.BaseCommentView=Backbone.View.extend({photosSelector:".js-photos",attachmentsSelector:".js-attachments",bodySelector:".js-body",htmlPreRendered:!1,showPhotos:!0,showAttachments:!0,upvotingEnabled:!0,replyEnabled:!0,lazyImage:!0,manager:null,imageTemplate:null,fileTemplate:_.template(n.JST["comment-attached-file"]),template:_.template(n.JST["comment-item"]),showRepliesTemplate:_.template(n.JST["comment-hidden-replies-toggler"]),authorOptsTemplate:_.template(n.JST["comment-author-opts"]),events:{"click .js-reply":"onClickReply","click .js-reply-parent":"scrollToParent","click .js-vote-btn, .js-vote-count":"toggleVote","click .js-show-replies":"showRemainingRepliesInThread","click .js-toggle-best-answer":"toggleBestAnswer","click .js-del-comment":"deleteComment","click .js-del-thread":"deleteThread"},initialize:function(e){var t=this;_.extend(t,_.pick(e,["manager","htmlPreRendered","showPhotos","showAttachments","upvotingEnabled","replyEnabled","lazyImage"])),!t.model&&t.htmlPreRendered&&(t.model=t.makeCommentModelFromEl(),t.collection.add(t.model)),t.listenTo(t.model,"change:numRepliesFromMe",t.updateNumRepliesFromMe),t.listenTo(t.model,"change:visible",t.toggleVisibility),t.listenTo(t.model,"remove",t.remove)},makeCommentModelFromEl:function(){var e=this,t=e.$el,i=e.manager,s=t.data(),o=t.find(".js-show-replies"),a=!!o.length,r=a?o.data("num-hidden"):null;return new n.models.CommentModel({id:s.id,stepId:s.stepid,inReplyTo:s.inreplyto,body:t.find(".text").text(),author:t.find(".user").text(),authorId:s.authorid,approved:!!s.approved,visible:!t.hasClass("hide"),lastVisibleInThread:a,numRepliesFromMe:r,instructableId:i.model.get("id")},{collection:e.collection})},getTemplateContext:function(){var e=this,t=e.model,n=e.manager.additionalCommentContext;return _.extend(e.model.toJSON(),{upvotingEnabled:e.upvotingEnabled,replyEnabled:e.replyEnabled,lazyImage:e.lazyImage,hasChildren:t.hasChildren()},n?n(t):{})},afterFilesRendered:function(){},scrollToParent:function(e){e.preventDefault(),this.manager.scrollToComment(this.model.get("inReplyTo"))},toggleVisibility:function(){this.$el[this.model.get("visible")?"removeClass":"addClass"]("hide")},showRemainingRepliesInThread:function(){var e=this,t=e.model;e.$(".js-show-replies").hide(),e.manager.showRepliesStartingFromModel(this.model),t.set({lastVisibleInThread:!1},{silent:!0})},updateNumRepliesFromMe:function(){var e,t,n=this,i=n.showRepliesTemplate,s=n.model.get("numRepliesFromMe"),o=n.$(".js-show-replies"),a=i({replyCountlabel:n.getReplyCountLabel(s)});o.length?o.replaceWith(a):(e=[n.attachmentsSelector,n.photosSelector,n.bodySelector],_.find(e,(function(e){return!!(t=n.$(e)).length})),t.after(a))},getReplyCountLabel:function(e){return this.model.isQuestion()?`${e} answer${e>1?"s":""}`:`${e} ${e>1?"replies":"reply"}`},render:function(){var e=this,t=e.$el;if(e.model.setReplyAuthor(),!e.htmlPreRendered){var n=e.getTemplateContext();e.setElement(e.template(n)),t[0].parentNode&&t.replaceWith(e.$el)}return e.renderAuthorIndicator(),e.showVoting(),e.showBestAnswerToggle(),e.renderFiles(),this},renderFiles:function(){this.renderPhotos(),this.renderAttachments(),this.afterFilesRendered()},renderPhotos:function(){var e=this;if(e.showPhotos){var t=e.model,i=e.imageTemplate,s=e.$(e.photosSelector),o=t.get("fileSet").getImages();_.each(o,(function(o){s.append(i(_.extend(o.toJSON(),{commentId:t.get("id"),imageLink:o.getLargeAnimationUrl(),imageSrc:n.isMobile()?o.getSquareAnimationUrl():o.getSquare3AnimationUrl(),lazyImage:e.lazyImage})))}))}},renderAttachments:function(){var e=this;if(e.showAttachments){var t=e.model,n=e.fileTemplate,i=e.$(e.attachmentsSelector),s=t.get("fileSet").getAttachments();_.each(s,(function(e){i.append(n(_.extend(e.toJSON(),{commentId:t.get("id"),typeThumbnail:e.getTypeThumbnailUrl(),attachmentUrl:e.getDownloadUrl()})))}))}},renderAuthorIndicator:function(){var e=this,t=e.model,n=e.manager,i=e.$(".author"),s="owner";if(!i.hasClass(s)){var o=n.model.get("author");_.isObject(o)&&(o=o.screenName),t.get("author")===o&&i.addClass(s)}},onClickReply:function(e){e.preventDefault();var t=this;n.requireLogin((function(){t.renderReplyView($(e.target),t.createReplyPostingView(t.model))}),{sourcea:"comments:reply"})},createReplyPostingView:function(e){return this.manager.makeReplyPostingView(e)},renderReplyView:function(e,t,i){if(e.hide(),t.render(),this.$el.append(t.$el),i){var s,o,a=n.isMobile()?$(".modal.in"):$(".modal-container");a.length?(s=a,o=t.$el.offset().top-s.offset().top+s.scrollTop()):(s=$("html, body"),o=t.$el.offset().top),_.delay((function(){s.animate({scrollTop:o},1e3)}),250)}this.listenToOnce(t,"posted destroyed",(function(){e.show()}))},showVoting:function(){var e=this,t=e.model;t.currentUserIsAuthor()?e.$(".js-vote").addClass("hide"):t.votableByCurrentUser()&&t.voted()&&e.$(".js-vote-btn").text("Upvoted").addClass("voted")},toggleVote:function(){var e=this,t=e.model;n.requireEmailVerification((function(){t.votableByCurrentUser()&&t.toggleVote().done((function(){e.$(".js-vote-count").text(t.votes()).removeClass("hide"),e.$(".js-vote-btn").text(t.voted()?"Upvoted":"Upvote").toggleClass("voted")}))}),{sourcea:"upvote"})},showBestAnswerToggle:function(){(this.manager.model.currentUserIsOwner()||n.session.isAdmin())&&this.$(".js-toggle-best-answer").removeClass("hide")},toggleBestAnswer:function(){var e=this,t=e.model;t.toggleBestAnswer().done((function(){e.$(".js-toggle-best-answer").html(t.isBestAnswer()?"Undo Best Answer":"Select as Best Answer")}))},deleteComment:function(){new n.views.CommentDeletePrompt({model:this.model,title:"Delete Comment",deleteThread:!1}).render()},deleteThread:function(){new n.views.CommentDeletePrompt({model:this.model,title:"Delete Comment Thread",deleteThread:!0}).render()},destroy:function(){this.stopListening(),this.undelegateEvents(),this.$el.removeData().unbind(),this.manager=null,this.model=null,this.collection=null}})}(window,document,Ibles),function(e,t){t.package("Ibles.views"),t.views.CommentTypeSelector=Backbone.View.extend({template:_.template(t.JST["comment-posting-view"]),events:{"click .js-type-tip":"renderTipPoster","click .js-type-question":"renderQuestionPoster","click .js-type-comment":"renderCommentPoster"},initialize:function(e){_.extend(this,_.pick(e,["manager"]))},scrollToMe:function(){e.location="#discuss"},renderPoster:function(e){var n=this,i=n.manager,s=e.modelProps;t.requireLogin((function(){var o=new t.views.CommentPostingView({model:i.makeCommentModel(s||{})}),a=e.callback;n.$el.html(o.render().$el),n.listenToOnce(o,"posted destroyed",(function(){n.render()})),a&&a()}),{sourcea:"comments:selecttype"})},renderPosterForType:function(e){this.renderPoster({modelProps:{designations:[e]}})},renderTipPoster:function(){this.renderPosterForType("tip")},renderQuestionPoster:function(){this.renderPosterForType("question")},renderCommentPoster:function(){this.renderPosterForType("comment")},render:function(){var e=this;return e.$el.html(e.template({commentBody:"",submitLabel:"Post",isEdit:!1,isIMadeIt:!1,typeSelected:!1,isMobile:t.isMobile(),avatar:t.session.getAvatarUrl()})),e}})}(window,Ibles),function(e,t,n){n.package("Ibles.views"),n.views.CommentPostingView=Backbone.View.extend({template:_.template(n.JST["comment-posting-view"]),skipUploaderModal:!1,hideOnBlur:!0,recreateOnPost:!1,submitLabel:"",events:{"click .post-btn":"submitPost","click .add-image-btn":"addImages","click .cancel-btn":"onCancel"},initialize:function(e){var t=this;e=e||{},_.bindAll(t,"onSend"),_.extend(t,_.pick(e,["recreateOnPost","hideOnBlur","skipUploaderModal","isEdit"])),t.listenTo(t.model,"comment.postError",t.renderError),t.manager=e.manager,t.hideOnBlur&&setTimeout((function(){t.setupHideOnBlur()}),0)},setupHideOnBlur:function(){var e=`click.${_.uniqueId("outside")}`,n=$(t),i=this;n.on(e,(function(t){i.$(".js-body-input").val().length||0!=$(t.target).closest([".js-comment-poster",".discuss",".modal",".modal-backdrop",".dropdown-backdrop"].join(",")).length||(n.off(e),i.destroyAndRemove(),i.trigger("canceled"))}))},getTemplateContext:function(){var e=this.model,t=e.hasDesignation(),i=e.isIMadeIt();return _.extend(e.toJSON(),{commentBody:e.get("body"),submitLabel:this.submitLabel,isMobile:n.isMobile(),isIMadeIt:i,isEdit:!!this.isEdit,typeSelected:t||i})},render:function(){var e=this,t=e.getTemplateContext(),i=n.session.authenticated(),s=n.isMobile();(e.$el.html(e.template(t)),i&&e.createImageBucket(),!s&&i&&e.enableRedactorToolbar(),s)&&e.$(".js-body-input").on("change keyup keydown paste cut",(function(){$(this).height(0).height(this.scrollHeight)}));return e},renderError:function(e){this.$(".alert-error").text(e).show()},createImageBucket:function(){var e=this,t=e.model.get("fileSet"),i=e.$(".uploading-indicator");e.imageBucket=new n.views.ImageBucketView({el:e.$(".image-bucket"),collection:t,skipUploaderModal:e.skipUploaderModal,multiple:!0}),e.listenTo(e.imageBucket,"imagebucket:uploading imagebucket:uploadcomplete",(function(){i.toggle()}))},enableRedactorToolbar:function(){this.redactorView=new n.views.RedactorTextAreaView({el:this.$(".js-redactor-container"),redactorOptions:{focus:!0,plugins:["instructablesAir"],linebreaks:!0}})},validate:function(){var e=this,t=!0;return e.$(".js-body-input").val()&&!e.$(".redactor_placeholder").length||(e.renderError("Please type your comment before posting."),t=!1),e.model.get("IMadeIt")&&!e.imageBucket.collection.models.length&&(e.renderError("Please attach images to show what you made!"),t=!1),t},submitPost:function(){var e=this,t=e.model;n.requireLogin((function(){if(e.$(".alert-error").hide(),e.validate()){var i=e.$(".post-btn");i.prop("disabled",!0),t.set({body:e.$(".js-body-input").val().replace(/\n/g,"<br/>")}),t.set({fileSet:new n.collections.FileCollection(e.imageBucket.collection.models)}),e.sendRequest().done(e.onSend).always((function(){i.prop("disabled",!1)}))}}),{sourcea:"comments:post"})},sendRequest:function(){return this.model.save()},addImages:function(){var e=this;n.requireLogin((function(){e.imageBucket.addImages()}),{sourcea:"comments:addImages"})},onSend:function(){var e=this;if($(".redactor_air").hide(),e.recreateOnPost){var t=e.model,n=t.cloneWithoutUserSuppliedData();n.collection=t.collection,e.destroy(),new e.constructor({el:e.$el,recreateOnPost:!0,model:n}).render()}else e.destroyAndRemove();e.trigger("posted")},onCancel:function(){$(".redactor_air").hide(),this.destroyAndRemove(),this.trigger("canceled")},destroy:function(){var e=this;e.$(".js-body-input").off().val(""),e.stopListening(),e.undelegateEvents(),e.$el.removeData().unbind(),e.model=null,e.imageBucket&&(e.imageBucket.destroy(),e.imageBucket=null),e.redactorView&&e.redactorView.reset(),e.manager=null,e.trigger("destroyed")},destroyAndRemove:function(){this.destroy(),this.$el.remove()}})}(window,document,Ibles),function(e){e.package("Ibles.views"),e.views.CommentReplyPostingView=e.views.CommentPostingView.fullExtend({hideOnBlur:!1,submitLabel:"Reply"})}(Ibles),function(e){e.package("Ibles.views"),e.views.CommentEditView=e.views.CommentPostingView.fullExtend({submitLabel:"Save",sendRequest:function(){return this.model.editRequest()},getTemplateContext:function(){return _.extend(this._super(),{isEdit:!0,typeSelected:!0})}})}(Ibles),function(e,t,n){n.package("Ibles.views"),n.views.CommentsManager=Backbone.View.extend({listSelector:".js-comments",itemSelector:".js-comment",moreSelector:".js-more-comments",model:null,numCommentsToLoad:50,numVisibleReplies:0,fetchIMadeItsOnly:!1,saveIMadeItsOnly:!1,skipUploaderModal:!1,fetchRatings:!1,includeQuarantine:!1,events:{"click .js-more-comments":"addComments","click .js-show-poster":"renderPoster"},initialize:function(e){var t=this,i=n.session.authenticated();_.bindAll(t,"renderComment","renderAllComments","onCommentAdded","showCommentFromUrl"),_.extend(t,_.pick(e,["fetchIMadeItsOnly","saveIMadeItsOnly","skipUploaderModal","fetchRatings","numVisibleReplies","numCommentsToLoad","additionalCommentContext"])),t.setSubviewClasses(),t.setCommentModelClasses(),t.setCommentCollection(),i||t.createCommentViewsFromDOM();var s=t.collection;t.listenTo(s,"add",t.onCommentAdded),t.listenTo(s,"reset",t.onCommentsLoaded),t.listenToOnce(s,"noMoreComments",t.noMoreComments),this.shouldReloadCommentTree()?this.reloadCommentTree(t.showCommentFromUrl):t.showCommentFromUrl()},shouldReloadCommentTree:function(){return n.session.authenticated()},reloadCommentTree:function(e){this.collection&&this.collection.reloadCommentTree().done(e)},setSubviewClasses:function(){this.postingView=n.views.CommentPostingView,this.commentView=n.views.CommentView,this.editView=n.views.CommentEditView,this.replyPostingView=n.views.CommentReplyPostingView},createCommentViewsFromDOM:function(){var e=[],t=this;t.$(t.listSelector).children(t.itemSelector).each((function(){var n=$(this),i=t.makeCommentView({el:n,htmlPreRendered:!0});i.render(),e.push(i)})),t.commentItemViews=e},setCommentModelClasses:function(){this.commentModelClass=n.models.CommentModel,this.commentCollectionClass=n.collections.CommentCollection},setCommentCollection:function(){var e=this;e.collection||(e.collection=new this.commentCollectionClass([],_.extend({limit:e.numCommentsToLoad,numVisibleReplies:e.numVisibleReplies,IMadeIt:e.fetchIMadeItsOnly,fetchRatings:e.fetchRatings,includeQuarantine:e.includeQuarantine},e.getExtraCollectionProps())))},getExtraCollectionProps:function(){return{instructableId:this.model.get("id"),ratingOptions:["instructableId"],modelOptions:["instructableId"]}},makeCommentModel:function(e){var t=this;return new this.commentModelClass(_.extend({},{instructableId:t.model.get("id"),IMadeIt:t.saveIMadeItsOnly},e),{collection:t.collection})},makeCommentView:function(e){return new this.commentView(_.extend({},{collection:this.collection,manager:this},e))},makeReplyPostingModel:function(e){return this.makeCommentModel({inReplyTo:e.get("id"),replyAuthor:e.get("author"),designations:e.isQuestion()?["answer"]:["comment"]})},makeReplyPostingView:function(e){return new this.replyPostingView({skipUploaderModal:this.skipUploaderModal,model:this.makeReplyPostingModel(e)})},makeEditView:function(e){return new(this.editView||this.postingView)({model:e,manager:this,collection:this.collection,skipUploaderModal:this.skipUploaderModal,isEdit:!0})},addComments:function(){this.collection.fetch()},noMoreComments:function(){this.$(this.moreSelector).hide()},onCommentAdded:function(e,t){this.renderComment(e,t)},onCommentsLoaded:function(){this.renderAllComments()},renderComment:function(e){var t=this,i=t.makeCommentView({model:e}).render().$el,s=t.$(t.itemSelector),o=e.collection.indexOf(e),a=t.listSelector;if(0===o?t.$(a).prepend(i):o===s.length?t.$(a).append(i):s.eq(o).before(i),n.user&&n.user.admin){var r=i.find("h3");e.get("quarantine")?r.text("[QUARANTINED] "+r.text()):e.get("limbo")&&r.text("[LIMBO] "+r.text())}t.$el.removeClass("hide")},renderAllComments:function(){var e=this.$(this.listSelector);_.each(this.commentItemViews,(function(e){e.destroy()})),e.css({"min-height":e.outerHeight()}),e.empty(),this.collection.each(this.renderComment),e.css({"min-height":"initial"})},renderPoster:function(e){var t=this;e.preventDefault(),n.requireLogin((function(){var n=new t.postingView({model:t.makeCommentModel({designations:["comment"]}),skipUploaderModal:t.skipUploaderModal,manager:t}),i=n.render().$el.hide(),s=$(e.target);t.$el.append(i),i.show("slow"),s.attr("disabled",!0),t.listenToOnce(n,"posted destroyed",(function(){s.attr("disabled",!1)})),t.listenToOnce(n,"posted",(function(){var e=t.$el;e.removeClass("hide"),$("body,html").animate({scrollTop:e.offset().top},"slow")}))}),{sourcea:"comments:showPoster"})},getCommentIdFromUrl:function(){return e.location.hash.slice(1).replace("comment-","")||n.Q("commentId")},hasCommentId:function(e){return!!this.collection.get(e)},showAllComments:function(){this.$(".js-show-replies").click()},showCommentFromUrl:function(){var t=this,n=t.getCommentIdFromUrl();n&&t.hasCommentId(n)&&(t.showAllComments(),e.setTimeout((function(){t.scrollToComment(n)}),100))},scrollToComment:function(e){var i=e&&$('[data-id="'+e+'"]');if(i){var s=i.offset().top-$("#ible-header").outerHeight()-50,o="true"===n.Q("reply");$(t).scrollTop(s),o&&i.find(".js-reply").click()}},showRepliesStartingFromModel:function(e){for(var t,n=this.collection,i=n.indexOf(e)+1,s=n.length-1,o=n.models;i<=s&&(t=o[i]).isReply();i++)t.set("visible","true")}})}(window,document,Ibles),function(e){e.package("Ibles.views"),e.views.CommentDeletePrompt=e.views.BaseModalView.fullExtend({events:{"click .delete-btn":"deleteComment"},initialize:function(e){this._super(_.extend({wrapContent:!0,modalClass:"delete-prompt"},e))},getTemplate:function(){return _.template(e.JST["comment-delete-prompt"])},deleteComment:function(e){e.preventDefault(),$(e.currentTarget).html($("<span class='spinner'></span>")[0]).addClass("disabled"),this.showDeleteAction(this.options.deleteThread?this.model.deleteThread():this.model.deleteComment())},showDeleteAction:function(e){var t=this;e.then((function(){t.dismiss()})).fail((function(){t.$(".cancel-btn").remove(),t.$(".delete-btn").remove(),t.$(".alert-error").removeClass("hide")}))}})}(Ibles),Ibles.package("Ibles.views"),Ibles.views.CommentRepliesManager=Ibles.views.CommentsManager.fullExtend({model:null,collection:null,initialize:function(e){this._super(e),this.comment=e.comment},shouldReloadCommentTree:function(){return!0},onCommentsLoaded:function(){this.hydratePrimaryCommentModel(),this.renderAllComments()},makeCommentView:function(e){return this._super(_.extend({lazyImage:!1},e))},hydratePrimaryCommentModel:function(){var e=this.comment,t=e.get("id"),n=this.collection.get(t);n&&e.set(n.attributes,{silent:!0})},renderAllComments:function(){var e=this,t=e.collection;t.each((function(n){e.renderComment(n,t)}))}}),Ibles.package("Ibles.views"),Ibles.views.CommentModal=Ibles.views.BaseModalView.fullExtend({template:_.template(Ibles.JST["comment-modal"]),model:null,modalEventNamespace:"CommentModal",browserScrollable:!0,events:{"click .js-next":"nextComment","click .js-prev":"previousComment"},initialize:function(e){this._super(e),this.repliesCollection=this.createRepliesCollection(),this.repliesView=this.createRepliesView(),this.listenTo(this.repliesCollection,"reset",this.renderComponents)},createRepliesCollection:function(){return new Ibles.collections.CommentCollection([],{commentId:this.model.get("id"),instructableId:this.options.instructableModel.get("id")})},createRepliesView:function(){var e=this;return new Ibles.views.CommentRepliesManager({el:this.$(".js-replies"),model:e.options.instructableModel,comment:e.model,collection:e.repliesCollection,skipUploaderModal:!0})},nextComment:function(){var e=this.model,t=e.collection,n=t.indexOf(e),i=n===t.length-1?0:n+1;Ibles.Events.trigger(`${this.modalEventNamespace}:next`,i)},previousComment:function(){var e=this.model,t=e.collection,n=t.indexOf(e),i=0===n?t.length-1:n-1;Ibles.Events.trigger(`${this.modalEventNamespace}:prev`,i)},getTemplateContext:function(){var e=this.model;return _.extend(this._super(),e.toJSON(),{hideNavigation:1===e.collection.length})},modalHidden:function(){this.model=null,this.repliesCollection=null,this.repliesView=null},renderComponents:function(){this.renderPrimaryComment(),this.model.get("fileSet").hasImages()&&this.renderCommentGallery()},renderPrimaryComment:function(){this.repliesView.makeCommentView({model:this.model,el:this.$(".js-primary-comment"),showPhotos:!1,lazyImage:!1}).render()},renderCommentGallery:function(){var e=_.template(Ibles.JST["comment-modal-gallery"]),t=Ibles.isMobile()?175:450,n=this.$(".modal-body").width(),i=this.model.get("fileSet").getImages(),s=this.galleryWillScroll(i,n,t);this.$(".js-gallery").append(e({galleryHeight:s?t:void 0,imageFiles:i,willScroll:s})),new Ibles.views.ScrollableCardsView({el:this.$(".js-gallery").children().first()})},galleryWillScroll:function(e,t,n){var i,s=e&&e.length>1,o=n;return s&&(i=_.reduce(e,(function(e,t){return e+o*(t.get("width")/t.get("height"))}),0)),s&&i>t}}),Ibles.JST["comment-image-file"]='<a rel="fancybox-thumb-<< commentId >>" href="<< imageLink >>" data-fancybox-href="/file/ << id >>">\n    <[ if (lazyImage) {]>\n        <img class="photo fancybox-thumb lazyload" alt="<< name >>" data-image-id="<< id >>" data-notes=\'<< imageNotes >>\' data-orig-height="<< height >>" data-orig-width="<< width >>" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-src="<< imageSrc >>"/>\n    <[ } else { ]>\n        <img class="photo fancybox-thumb" alt="<< name >>" data-image-id="<< id >>" data-notes=\'<< imageNotes >>\' data-orig-height="<< height >>" data-orig-width="<< width >>" src="<< imageSrc >>"/>\n    <[ } ]>\n</a>\n',Ibles.JST["comment-flag-dropdown"]='<div class="action dropdown flag-dropdown hide">\n    <a class="dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-flag"></i></a>\n    <ul class="dropdown-menu">\n        <li><a class="js-flag" data-flagname="not_nice">Not Nice</a></li>\n        <li><a class="js-flag" data-flagname="inappropriate">Inappropriate</a></li>\n        <li><a class="js-flag" data-flagname="spam">Spam</a></li>\n    </ul>\n</div>\n',Ibles.JST["comment-admin"]='<div class="comment-admin">\n    <span class="checkbox pull-right action">\n        <input type="checkbox" class="js-approved" name=""/>Approved\n    </span>\n    <[ if (hasChildren){]>\n        <a class="action pull-right js-del-thread">[delete thread]</a>\n    <[ } else { ]>\n        <a class="action pull-right js-del-comment">[delete]</a>\n    <[ } ]>\n    <a class="action pull-right js-publish <[ if (!limbo && !quarantine) {]>hide<[}]>">[publish]</a>\n    <a class="action pull-right js-limbo <[ if (limbo) {]>hide<[}]>">[limbo]</a>\n    <a class="action pull-right js-quarantine  <[ if (quarantine) {]>hide<[}]>">[quarantine]</a>\n    <[ if (Ibles.pageContext.ibleData && Ibles.pageContext.ibleData.lessonId) { ]>\n        <a class="action pull-right js-limbo-class-projects">[limbo projects]</a>\n    <[ } ]>\n    <[ if (!inReplyTo) {]>\n    <a class="action pull-right js-to-tip <[ if (designatedTip) {]>hide<[}]>">[tip]</a>\n    <a class="action pull-right js-to-question <[ if (designatedQuestion) {]>hide<[}]>">[question]</a>\n    <a class="action pull-right js-to-comment <[ if (designatedComment) {]>hide<[}]>">[comment]</a>\n    <[ } ]>\n\n    <span class="checkbox pull-right action">\n        <input type="checkbox" class="js-imadeit" <[ if (IMadeIt) {]>checked<[}]>> IMadeIt <span class="alert-error imadeit-warning hide">(images required)</span>\n    </span>\n\n    <span class="checkbox pull-right action">\n        <input type="checkbox" class="js-sticky" name=""/>Feature Comment\n    </span>\n\n    <img class="request-img pull-right hide" src="<< Ibles.staticUrl(\'img/spinner.gif\') >>" height=\'10\' width=\'10\'/>\n    <img class="request-success pull-right hide" src="<< Ibles.staticUrl(\'img/ico_check.gif\') >>" height=\'10\' width=\'10\'/>\n    <img class="request-failure pull-right hide" src="<< Ibles.staticUrl(\'img/ico_cross.gif\') >>" height=\'10\' width=\'10\'/>\n</div>\n',function(e){e.package("Ibles.views"),e.views.CommentView=e.views.BaseCommentView.fullExtend({quarantineMessage:"THIS COMMENT HAS BEEN QUARANTINED",limboMessage:"THIS COMMENT HAS BEEN LIMBOED",imageTemplate:_.template(e.JST["comment-image-file"]),flagTemplate:_.template(e.JST["comment-flag-dropdown"]),adminActionsTemplate:_.template(e.JST["comment-admin"]),events:{"click .js-flag":"flagComment","click .js-to-tip":"makeTip","click .js-to-question":"makeQuestion","click .js-to-comment":"makeComment","click .js-imadeit":"toggleIMadeIt","click .js-edit":"editComment","click .js-limbo":"limboComment","click .js-quarantine":"quarantine","click .js-publish":"publishComment","click .js-sticky":"toggleSticky","click .js-approved":"toggleApproval"},initialize:function(e){this._super(e)},designate:function(e){this.showRequestFeedback(this.model.setDesignations(e)),this.model.get("IMadeIt")&&this.model.setIMadeIt(!1)},makeTip:function(){this.designate(["tip"])},makeQuestion:function(){this.designate(["question"])},makeComment:function(){this.designate(["comment"])},render:function(){var t=this,n=t.manager,i=t.model,s=e.session,o=s.isAdmin(),a=s.authenticated(),r=i.currentUserIsAuthor(),l=i.authorIsProjectOwner(n.model);if(t._super(),o){t.$el.append(t.adminActionsTemplate(t.getTemplateContext()));var c=i.get("status"),d=i.get("quarantine")||"QUARANTINED"==c,u=i.get("limbo")||"LIMBO"==c;(d||u)&&(t.$(".js-quarantine-message").html(d?t.quarantineMessage:t.limboMessage).show(),t.$(".js-publish").show()),d?t.$(".js-limbo").show():u?t.$(".js-quarantine").show():t.$(".js-limbo, .js-quarantine").show()}return a&&t.$(".js-toolbar").prepend(t.flagTemplate()),l&&t.$(".author").addClass("owner"),i.get("author")===s.get("screenName")&&t.$(".js-del-comment").show(),!0===i.get("sticky")&&t.$(".js-sticky").prop("checked",!0),!0===i.get("approved")&&t.$(".js-approved").prop("checked",!0),(r||o)&&t.$(".js-toolbar").prepend(t.authorOptsTemplate(t.getTemplateContext())),t.attachCommentImagesFancybox(),t},flagComment:function(e){this.showRequestFeedback(this.model.flagComment($(e.currentTarget).data("flagname")))},limboComment:function(){this.showRequestFeedback(this.model.limbo()),this.$(".js-limbo").hide(),this.$(".js-publish, .js-quarantine").show(),this.$(".js-quarantine-message").html(this.limboMessage).show()},quarantine:function(){this.showRequestFeedback(this.model.quarantine()),this.$(".js-quarantine").hide(),this.$(".js-publish, .js-limbo").show(),this.$(".js-quarantine-message").html(this.quarantineMessage).show()},publishComment:function(){this.showRequestFeedback(this.model.publish()),this.$(".js-limbo").show(),this.$(".js-publish").hide(),this.$(".js-quarantine-message").hide()},toggleSticky:function(e){this.showRequestFeedback(this.model.toggleStickyComment($(e.currentTarget).prop("checked")))},toggleApproval:function(e){this.showRequestFeedback(this.model.toggleApproval($(e.currentTarget).prop("checked")))},showRequestFeedback:function(e){var t=this;this.$(".request-img").show(),e.then((function(){t.$(".request-img").hide(),t.$(".request-success").show(),t.$(".request-success").fadeOut()})).fail((function(){t.$(".request-img").hide(),t.$(".request-failure").show(),t.$(".request-failure").fadeOut()}))},attachCommentImagesFancybox:function(){this.$(this.photosSelector).find("a").fancybox()},editComment:function(){var e=this,t=e.$(".js-edit-container"),n=e.manager.makeEditView(e.model);e.toggleSpaceForEditView(),e.editView=n,t.html(n.render().$el),e.listenTo(n,"canceled",e.onEditViewCanceled),e.listenTo(n,"posted",e.onEditViewPosted)},toggleSpaceForEditView:function(){var e=this;e.$(".js-edit").toggle(),e.$(".js-hide-on-edit").toggle(),e.$(".js-text").toggle(),e.$(".js-photos").toggle()},onEditViewCanceled:function(){var e=this;e.editView&&(e.toggleSpaceForEditView(),e.editView.destroy(),e.editView=null)},onEditViewPosted:function(){var e=this,t=e.model,n=e.manager.makeCommentView({model:t,lazyImage:!1}).render();e.editView.destroy(),e.editView=null,e.destroy(),e.$el.replaceWith(n.$el)},toggleIMadeIt:function(){var e=this,t=e.model,n=e.$(".imadeit-warning");n.hide();var i=t.setIMadeIt(e.$(".js-imadeit").is(":checked"));i.fail((function(){n.show()})),this.showRequestFeedback(i)}}),e.views.DesktopCommentView=e.views.CommentView}(Ibles),Ibles.JST["imadeit-item"]='<li data-id="<< id >>" class="imadeit js-comment <[ if (typeof hidden != \'undefined\' && hidden) {]>hide<[}]>">\n    <[ if (fileSet.models.length && fileSet.models[0].isImage()) { ]>\n        <img class="lazyload" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-src="<< fileSet.models[0].getSquare3AnimationUrl() >>">\n    <[ } else if (fileSet.models.length && fileSet.models[0].isVideo()) { ]>\n        <img src="<< Ibles.staticUrl(\'img/placeholder-video.png\') >>" />\n    <[ } else { ]>\n        <img src="<< Ibles.staticUrl(\'img/placeholder-file.png\') >>" />\n    <[ } ]>\n    <h3 class="made-by"><a class="user" href="<< Ibles.reverseUrls.memberUrl(author) >>"><< author >></a> made it!</h3>\n</li>\n',Ibles.JST["imadeit-seemore"]='<li class="see-more">\n    <div class="see-more-inner">\n        <p>See << hiddenCount >> more that made it</p>\n    </div>\n</li>',Ibles.package("Ibles.views"),Ibles.views.ImadeItsManager=Ibles.views.CommentsManager.fullExtend({fetchIMadeItsOnly:!0,saveIMadeItsOnly:!0,includeQuarantine:!0,events:{"click .see-more":"showHiddenItems"},initialize:function(e){this._super(e),this.listenTo(Ibles.Events,"iMadeItModal:next iMadeItModal:prev",this.onImadeItModalNav)},setSubviewClasses:function(){this._super(),this.commentView=Ibles.views.ImadeItItemView},setCommentModelClasses:function(){this.commentModelClass=Ibles.models.CommentModel,this.commentCollectionClass=Ibles.collections.ImadeItCollection},onCommentsLoaded:function(){this.filterQuarantineModels(),this.setHiddenModels(),this.renderAllComments(),this.renderSeeMoreToggler()},onImadeItModalNav:function(e){new Ibles.views.ImadeItModal({model:this.collection.at(e),instructableModel:this.model}).render()},renderSeeMoreToggler:function(){var e,t=this.getHiddenCount();t>0&&(e=_.template(Ibles.JST["imadeit-seemore"]),this.$(this.listSelector).append(e({hiddenCount:t})))},showHiddenItems:function(){var e=this;Ibles.requireLogin((function(){e.$(".see-more").hide(),e.$("li.hide").removeClass("hide")}),{sourcea:"imadeitSeeMore"})},showAllComments:function(){this.showHiddenItems()},getHiddenCount:function(){var e=this.collection.length,t=0;return e>9?t=e-9:e>4&&9!=e&&(t=e-4),t},filterQuarantineModels:function(){this.collection.models=this.collection.models.reduce((function(e,t){return t.get("quarantine")||t.get("limbo")?(Ibles.user.admin||Ibles.user.screenName===t.get("author"))&&e.push(t):e.push(t),e}),[])},setHiddenModels:function(){var e=this.collection,t=e.length-this.getHiddenCount();e.each((function(e,n){e.set("hidden",n>=t)}))}}),Ibles.package("Ibles.views"),Ibles.views.ImadeItItemView=Ibles.views.CommentView.fullExtend({template:_.template(Ibles.JST["imadeit-item"]),events:{click:"renderModal"},makeCommentModelFromEl:function(){var e=this.$el,t=(e.find("img").attr("src")||"").split("?")[0];return this.manager.makeCommentModel({id:e.data().id,author:e.find(".user").text(),files:[{originalUrl:t}]})},renderModal:function(){new Ibles.views.ImadeItModal({model:this.model,instructableModel:this.manager.model}).render()},onEditViewPosted:function(){this.manager.reloadCommentTree()}}),Ibles.package("Ibles.collections"),Ibles.collections.ImadeItCollection=Ibles.collections.CommentCollection.extend({apiEndPoint:"searchComments",getExtraCollectionProps:function(){return _.extend(this.super(),{IMadeIt:!0})}}),Ibles.package("Ibles.views"),Ibles.views.ImadeItModal=Ibles.views.CommentModal.fullExtend({modalClass:"imadeit-modal",modalEventNamespace:"iMadeItModal"}),Ibles.JST["hamburger-menu-auth-section"]='<div id="auth-section" class="clearfix">\n    <li class="auth-section-links">\n        <a class="main-menu profile-link" data-bypass="true" href="<< memberUrl >>">\n            <img class="avatar" src="<< avatarUrl >>"/> Profile\n        </a>\n        <a class="main-menu logout-link btn-logout">\n            Logout\n        </a>\n    </li>\n</div>\n',function(e,t,n){function i(e,t){return typeof e===t}function s(e,t){return!!~(""+e).indexOf(t)}function o(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):y?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function a(e){return e.replace(/([a-z])-([a-z])/g,(function(e,t,n){return t+n.toUpperCase()})).replace(/^-/,"")}function r(e,t){return function(){return e.apply(t,arguments)}}function l(e){return e.replace(/([A-Z])/g,(function(e,t){return"-"+t.toLowerCase()})).replace(/^ms-/,"-ms-")}function c(t,n,i){var s;if("getComputedStyle"in e){s=getComputedStyle.call(e,t,n);var o=e.console;if(null!==s)i&&(s=s.getPropertyValue(i));else if(o){o[o.error?"error":"log"].call(o,"getComputedStyle returning null, its possible modernizr test results are inaccurate")}}else s=!n&&t.currentStyle&&t.currentStyle[i];return s}function d(e,n,i,s){var a,r,l,c,d="modernizr",u=o("div"),h=function(){var e=t.body;return e||((e=o(y?"svg":"body")).fake=!0),e}();if(parseInt(i,10))for(;i--;)(l=o("div")).id=s?s[i]:d+(i+1),u.appendChild(l);return(a=o("style")).type="text/css",a.id="s"+d,(h.fake?h:u).appendChild(a),h.appendChild(u),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),u.id=d,h.fake&&(h.style.background="",h.style.overflow="hidden",c=w.style.overflow,w.style.overflow="hidden",w.appendChild(h)),r=n(u,e),h.fake?(h.parentNode.removeChild(h),w.style.overflow=c,w.offsetHeight):u.parentNode.removeChild(u),!!r}function u(t,i){var s=t.length;if("CSS"in e&&"supports"in e.CSS){for(;s--;)if(e.CSS.supports(l(t[s]),i))return!0;return!1}if("CSSSupportsRule"in e){for(var o=[];s--;)o.push("("+l(t[s])+":"+i+")");return d("@supports ("+(o=o.join(" or "))+") { #modernizr { position: absolute; } }",(function(e){return"absolute"==c(e,null,"position")}))}return n}function h(e,t,r,l){function c(){h&&(delete S.style,delete S.modElem)}if(l=!i(l,"undefined")&&l,!i(r,"undefined")){var d=u(e,r);if(!i(d,"undefined"))return d}for(var h,m,p,f,g,b=["modernizr","tspan","samp"];!S.style&&b.length;)h=!0,S.modElem=o(b.shift()),S.style=S.modElem.style;for(p=e.length,m=0;p>m;m++)if(f=e[m],g=S.style[f],s(f,"-")&&(f=a(f)),S.style[f]!==n){if(l||i(r,"undefined"))return c(),"pfx"!=t||f;try{S.style[f]=r}catch(e){}if(S.style[f]!=g)return c(),"pfx"!=t||f}return c(),!1}function m(e,t,n,s,o){var a=e.charAt(0).toUpperCase()+e.slice(1),l=(e+" "+C.join(a+" ")+a).split(" ");return i(t,"string")||i(t,"undefined")?h(l,t,s,o):function(e,t,n){var s;for(var o in e)if(e[o]in t)return!1===n?e[o]:i(s=t[e[o]],"function")?r(s,n||t):s;return!1}(l=(e+" "+x.join(a+" ")+a).split(" "),t,n)}function p(e,t,i){return m(e,n,n,t,i)}var f=[],g=[],b={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout((function(){t(n[e])}),0)},addTest:function(e,t,n){g.push({name:e,fn:t,options:n})},addAsyncTest:function(e){g.push({name:null,fn:e})}},v=function(){};v.prototype=b,v=new v;var w=t.documentElement,y="svg"===w.nodeName.toLowerCase(),I="Moz O ms Webkit",C=b._config.usePrefixes?I.split(" "):[];b._cssomPrefixes=C;var x=b._config.usePrefixes?I.toLowerCase().split(" "):[];b._domPrefixes=x;var k={elem:o("modernizr")};v._q.push((function(){delete k.elem}));var S={style:k.elem.style};v._q.unshift((function(){delete S.style})),b.testAllProps=m,b.testAllProps=p,v.addTest("cssanimations",p("animationName","a",!0)),v.addTest("csstransitions",p("transition","all",!0));var T=function(t){var i,s=prefixes.length,o=e.CSSRule;if(void 0===o)return n;if(!t)return!1;if((i=(t=t.replace(/^@/,"")).replace(/-/g,"_").toUpperCase()+"_RULE")in o)return"@"+t;for(var a=0;s>a;a++){var r=prefixes[a];if(r.toUpperCase()+"_"+i in o)return"@-"+r.toLowerCase()+"-"+t}return!1};b.atRule=T,b.prefixed=function(e,t,n){return 0===e.indexOf("@")?T(e):(-1!=e.indexOf("-")&&(e=a(e)),t?m(e,t,n):m(e,"pfx"))},function(){var e,t,n,s,o,a;for(var r in g)if(g.hasOwnProperty(r)){if(e=[],(t=g[r]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(s=i(t.fn,"function")?t.fn():t.fn,o=0;o<e.length;o++)1===(a=e[o].split(".")).length?v[a[0]]=s:(!v[a[0]]||v[a[0]]instanceof Boolean||(v[a[0]]=new Boolean(v[a[0]])),v[a[0]][a[1]]=s),f.push((s?"":"no-")+a.join("-"))}}(),function(e){var t=w.className,n=v._config.classPrefix||"";if(y&&(t=t.baseVal),v._config.enableJSClass){var i=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(i,"$1"+n+"js$2")}v._config.enableClasses&&(t+=" "+n+e.join(" "+n),y?w.className.baseVal=t:w.className=t)}(f),delete b.addTest,delete b.addAsyncTest;for(var M=0;M<v._q.length;M++)v._q[M]();e.Modernizr=v}(window,document),function(e,t,n){"use strict";var i=t.Modernizr,s=e("body");e.DLMenu=function(t,n){this.$el=e(n),this._init(t)},e.DLMenu.defaults={animationClasses:{classin:"dl-animate-in-1",classout:"dl-animate-out-1"},onLevelClick:function(e,t){return!1},onLinkClick:function(e,t){return!1}},e.DLMenu.prototype={_init:function(t){if(this.options=e.extend(!0,{},e.DLMenu.defaults,t),this._config(),i){this.animEndEventName={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"}[i.prefixed("animation")]+".dlmenu",this.transEndEventName={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[i.prefixed("transition")]+".dlmenu",this.supportAnimations=i.cssanimations,this.supportTransitions=i.csstransitions}this._initEvents()},_config:function(){this.open=!1,this.$trigger=this.$el.children(".dl-trigger"),this.$menu=this.$el.children("ul.dl-menu"),this.$menuitems=this.$menu.find("li:not(.dl-back)"),this.$el.find("ul.dl-submenu").prepend('<li class="dl-back"><a href="#">back</a></li>'),this.$back=this.$menu.find("li.dl-back")},_initEvents:function(){var t=this;this.$trigger.on("click.dlmenu",(function(){return t.open?t._closeMenu():t._openMenu(),!1})),this.$menuitems.on("click.dlmenu",(function(n){var i=e(this),s=i.children("ul.dl-submenu");if(i.hasClass("passthrough")||n.stopPropagation(),s.length>0){var o=s.clone().css("opacity",0).insertAfter(t.$menu),a=function(){t.$menu.off(t.animEndEventName).removeClass(t.options.animationClasses.classout).addClass("dl-subview"),i.addClass("dl-subviewopen").parents(".dl-subviewopen:first").removeClass("dl-subviewopen").addClass("dl-subview"),o.remove()};return setTimeout((function(){o.addClass(t.options.animationClasses.classin),t.$menu.addClass(t.options.animationClasses.classout),t.supportAnimations?t.$menu.on(t.animEndEventName,a):a.call(),t.options.onLevelClick(i,i.children("a:first").text())})),!1}t.options.onLinkClick(i,n)})),this.$back.on("click.dlmenu",(function(n){var i=e(this),s=i.parents("ul.dl-submenu:first"),o=s.parent(),a=s.clone().insertAfter(t.$menu),r=function(){t.$menu.off(t.animEndEventName).removeClass(t.options.animationClasses.classin),a.remove()};return setTimeout((function(){a.addClass(t.options.animationClasses.classout),t.$menu.addClass(t.options.animationClasses.classin),t.supportAnimations?t.$menu.on(t.animEndEventName,r):r.call(),o.removeClass("dl-subviewopen");var e=i.parents(".dl-subview:first");e.is("li")&&e.addClass("dl-subviewopen"),e.removeClass("dl-subview")})),!1}))},closeMenu:function(){this.open&&this._closeMenu()},_closeMenu:function(){var t=this,n=function(){t.$menu.off(t.transEndEventName),t._resetMenu()};this.$menu.removeClass("dl-menuopen"),this.$menu.addClass("dl-menu-toggle"),this.$trigger.removeClass("dl-active"),e(".overlay").removeClass("visible"),e("body").removeClass("stop-scrolling"),e("html").removeClass("stop-scrolling"),this.supportTransitions?this.$menu.on(this.transEndEventName,n):n.call(),this.open=!1},openMenu:function(){this.open||this._openMenu()},_openMenu:function(){var t=this;this.$menu.trigger("dlmenu.startOpen"),s.off("click").on("click.dlmenu",(function(){t._closeMenu()})),this.$menu.addClass("dl-menuopen dl-menu-toggle").on(this.transEndEventName,(function(){e(this).removeClass("dl-menu-toggle")})),this.$trigger.addClass("dl-active"),e("html").addClass("stop-scrolling"),e("body").addClass("stop-scrolling"),e(".overlay").addClass("visible"),this.open=!0},_resetMenu:function(){this.$menu.removeClass("dl-subview"),this.$menuitems.removeClass("dl-subview dl-subviewopen")}};var o=function(e){t.console&&t.console.error(e)};e.fn.dlmenu=function(t){if("string"==typeof t){var n=Array.prototype.slice.call(arguments,1);this.each((function(){var i=e.data(this,"dlmenu");i?e.isFunction(i[t])&&"_"!==t.charAt(0)?i[t].apply(i,n):o("no such method '"+t+"' for dlmenu instance"):o("cannot call methods on dlmenu prior to initialization; attempted to call method '"+t+"'")}))}else this.each((function(){var n=e.data(this,"dlmenu");n?n._init():n=e.data(this,"dlmenu",new e.DLMenu(t,this))}));return this}}(jQuery,window),function(e,t){t.package("Ibles.views"),t.views.HamburgerMenu=Backbone.View.extend({initialize:function(e){var t=this;e&&e.async?this.getMenuContents().done((function(){t.bindMenuPlugin(),t.enableResize(),t.updateAuthUI()})):(t.bindMenuPlugin(),t.enableResize(),t.updateAuthUI())},bindMenuPlugin:function(){this.$el.dlmenu({})},enableResize:function(){var t=this;t.setSizes(),$(e).resize(_.debounce((function(){t.setSizes()}),250))},getMenuContents:function(){var e=this;return $.ajax("/parts/hamburger_menu/").then((function(t){e.$(".dl-menu").html(t),e.updateAuthUI()}))},setSizes:function(){if(t.isMobile()){var n=$(e).height(),i=$("#main-header");$(".overlay").height(n+70),$(".channels-menu").height(n-i.outerHeight()),$(".dl-menu").height(n-i.outerHeight())}},updateAuthUI:function(){var e=$(".logged-in-item"),n=$(".logged-out-item");if(t.session.authenticated()){var i=t.session,s=_.extend(t.session.toJSON(),{memberUrl:i.getMemberUrl(),avatarUrl:i.getAvatarUrl()}),o=_.template(t.JST["hamburger-menu-auth-section"]);$("#auth-container").html(o(s)),n.removeClass("visible"),e.addClass("visible"),$("#auth-container .btn-logout").on("click",(function(){t.logout()}))}else e.removeClass("visible"),n.addClass("visible")}})}(window,Ibles),Ibles.JST["sticky-header-desktop"]='<div class="sticky-header" data-location="stickyNav">\n\t<div id="hamburger-menu" class="dl-menuwrapper hamburger-menu">\n\t\t<button class="dl-trigger"><i class="svg-icon svg-hamburger"></i><span class="sr-only">Open Menu</span></button>\n\t\t<ul class="dl-menu"></ul>\n\t</div>\n    <span class="byline">\n        <span class="title"><< title >></span> by <a class="author" rel="author" href="<< authorUrl >>"><< screenName >></a><button class="btn btn-yellow follow-btn">Follow</button>\n    </span>\n    <span class="ible-actions">\n        <[ if (type == "Step by Step") {]>\n        <button class="pdf-btn login-required" data-sourcea="download"><i class="svg-icon svg-pdf"></i>Download</button>\n        <[ } ]>\n        <button class="favorite-btn"><i class="svg-icon svg-favorite"></i><span class="favorite-txt">Favorite</span></button>\n        <[ if (type == "Step by Step") {]>\n        <button class="imadeit-btn"><i class="icon icon-imadeit"></i><span class="imadeit-txt">I Made It</span></button>\n        <button class="view-comments-btn"><a href="#discuss"><i class="svg-icon svg-comments"></i><span class="sr-only">View Comments</span></a></button>\n        <[ } ]>\n        <button class="share-menu-btn"><i class="svg-icon svg-share"></i><span class="sr-only">Share</span></button>\n        <button class="more-menu-btn"><i class="svg-icon svg-ellipsis"></i><span class="sr-only">More Options</span></button>\n    </span>\n    <div class="dropdown share-menu">\n        <button class="btn btn-facebook fb-btn"><i class="svg-icon svg-facebook"></i> Facebook</button>\n        <button class="btn btn-twitter twit-btn"><i class="svg-icon svg-twitter"></i> Twitter</button>\n        <button class="btn btn-danger pin-btn"><i class="svg-icon svg-pinterest"></i> Pinterest</button>\n        <button class="btn google-classroom-btn"><i class="icon-google-classroom"></i> Google Classroom</button>\n    </div>\n    <div class="dropdown more-menu">\n        <button class="btn flag-menu-btn">Flag</button>\n        <ul class="flag-menu unstyled hide">\n            <li><a class="flag-btn" data-as="wrong-category">Wrong Category</a></li>\n            <li><a class="flag-btn" data-as="inappropriate">Inappropriate</a></li>\n            <li><a class="flag-btn" data-as="incomplete">Incomplete</a></li>\n            <li><a class="flag-btn" data-as="spam">Spam</a></li>\n        </ul>\n        <button class="btn add-to-collection-btn">Add To Collection</button>\n        <button class="btn add-to-contest-btn admin-action">Add To Contest</button>\n        <button class="btn edit-btn author-action">Edit</button>\n    </div>\n</div>\n',Ibles.views.StickyHeaderBase=Backbone.View.extend({template:null,initialize:function(){this.render(),this.setupScrollFix()},hide:function(){},render:function(){var e=this,t=e.model,n=t.author;e.$el.append(e.template({title:t.get("title"),screenName:n.get("screenName"),authorUrl:n.getUrl(),authorAvatar:n.getAvatarFile().getTinyUrl(),type:t.get("type")}))},setupScrollFix:function(){var e=this,t=e.$(".sticky-header"),n=e.$(".article-header"),i=n.offset().top+n.height();$(window).scroll(_.throttle((function(){$(window).scrollTop()>=i?(t.addClass("affix"),Ibles.Events.trigger("fixHeaderShown",{headerHeight:50})):(t.removeClass("affix"),e.$(".more-menu").hide(),Ibles.Events.trigger("fixHeaderHidden"))}),250))}}),Ibles.package("Ibles.views"),Ibles.views.StickyHeader=Ibles.views.StickyHeaderBase.fullExtend({template:_.template(Ibles.JST["sticky-header-desktop"]),events:{"click .flag-menu-btn":"toggleFlagMenu","click .flag-btn":"attemptFlag","click .edit-btn":"editBtnClicked","click .share-menu-btn":"toggleShareMenu","click .more-menu-btn":"toggleMoreMenu","click .add-to-collection-btn":"showAddToCollectionModal","click .add-to-contest-btn":"showAddToContestModal"},initialize:function(){this._super(),this.menu=new Ibles.views.HamburgerMenu({el:"#hamburger-menu",async:!0})},hide:function(){var e=this;setTimeout((function(){e.$(".sticky-header").removeClass("affix")}),250)},editBtnClicked:function(){window.location=this.model.getEditUrl()},toggleShareMenu:function(e){this.toggleDropdownMenu(e,$(".share-menu-btn"),$(".share-menu"))},toggleMoreMenu:function(e){this.toggleDropdownMenu(e,$(".more-menu-btn"),$(".more-menu"))},toggleDropdownMenu:function(e,t,n){n.is(":visible")?(n.hide(),$(document).off("click.outside-menu")):(n.show(),setTimeout((function(){$(document).on("click.outside-menu",(function(e){var i=$(e.target),s=i.is(t),o=!!i.closest(".dropdown").length;s||o||($(document).off("click.outside-menu"),n.hide())}))})))},toggleFlagMenu:function(){Ibles.requireLogin((function(){this.$(".flag-menu").toggle()}),{sourcea:"flag"})},attemptFlag:function(e){e.preventDefault();var t=this.model,n=$(e.target),i=n.text(),s=n.attr("data-as");new Ibles.views.ConfirmationView({model:new Ibles.models.ConfirmationModel({confirmationMessage:Ibles.T(Ibles.text.messages.confirmFlag.replace("<< reason >>",i))}),callbackFn:function(){t.set("flaggedAs",s),t.flagAction().success(Ibles.views.AlertView.callbackFactory("success")).error(Ibles.views.AlertView.callbackFactory("error"))}})},showAddToCollectionModal:function(){var e=this;this.$(".more-menu").hide(),Ibles.requireLogin((function(){Ibles.loadJsBundle("create_collection_js",$.proxy(e.renderAddToCollectionModal,e))}),{sourcea:"showAddToCollectionModal"})},renderAddToCollectionModal:function(){if(!this.addToCollectionView){var e=$(".add-to-collection-btn");e.addClass("loading");var t=Ibles.pageContext.ibleData;this.addToCollectionView=new Ibles.views.AddToCollectionView({ibleId:t.id,ibleTitle:t.title,coverImage:t.coverImage}),this.listenToOnce(this.addToCollectionView,"ready",(function(){e.removeClass("loading")}))}this.addToCollectionView.render()},showAddToContestModal:function(){this.addToContestView||(this.addToContestView=new Ibles.views.AddToContestView({ibleData:Ibles.pageContext.ibleData})),this.addToContestView.render()}}),function(){var e=Ibles.pageContext.ibleData;e&&window.LogHit&&window.LogHit(e.id,e.author.id)}(),Ibles.package("Ibles.views"),Ibles.views.BaseInstructableView=Backbone.View.extend({events:{"click .favorite-btn":"attemptFave","click .follow-btn":"attemptFollow","click .download-pdf, .pdf-btn":"downloadPDF","click .facebook-share-button, .fb-btn":"shareOnFacebook","click .pinterest-share-button, .pin-btn":"shareOnPinterest","click .twittr-share-button, .twit-btn":"shareOnTwitter","click .google-classroom-btn":"shareOnGoogleClassroom"},initialize:function(e){this.opts=_.clone(e||{}),this.renderPostedDate(),this.setUpCategoryTracking(),this.updateFollowingState(),this.updateFavoriteState(),this.listenTo(this.model,"change:favorite",this.updateFavoriteState),this.listenTo(this.model.author,"change:following",this.updateFollowingState),this.listenTo(this.model,"change:favorites change:views",this.updateStats)},renderPostedDate:function(){if(Ibles.session.authenticated()){var e=dayjs(this.model.get("publishDate")),t="Unpublished";this.model.get("isPreview")||(t="Published "+e.format("MMM Do, YYYY")),this.$(".posted-date").text(" "+t).show()}},downloadPDF:function(){var e=this;Ibles.requireLogin((function(){e.downloadPdfOnly()}))},downloadPdfOnly:function(){Ibles.locationAssign(this.model.getPdfUrl())},attemptFave:function(e){var t=this;e.preventDefault(),Ibles.requireLogin((function(){Ibles.alertWhenError(t.model.favoriteAction())}),{sourcea:"favorite"})},attemptFollow:function(e){var t=this;e.preventDefault(),Ibles.requireLogin((function(){Ibles.alertWhenError(t.model.author.toggleFollowing())}),{sourcea:"follow"})},updateFavoriteState:function(){var e=$(".favorite-btn"),t=$(".favorite-txt");this.model.get("favorite")?(e.addClass("active"),t.text("Favorited")):(e.removeClass("active"),t.text("Favorite"))},updateFollowingState:function(){var e=this.model.author.get("following");$(".follow-btn").html(e?"Following":"Follow")},updateStats:function(){var e=this.model,t=e.get("favorites"),n=e.get("views");t>0&&this.$(".favorite-count").html(t.toLocaleString()),n>0&&this.$(".view-count").html(n.toLocaleString())},shareOnFacebook:function(e){e.preventDefault(),Ibles.fbShare(this.model.get("fullUrl"))},shareOnPinterest:function(e){e.preventDefault(),window.open(`https://www.pinterest.com/pin/create/button/?url=${encodeURIComponent(this.model.get("fullUrl"))}&description=${encodeURIComponent(this.model.get("title"))}&media=${this.model.get("shareImageUrl")}`,"_blank")},shareOnTwitter:function(e){e.preventDefault(),window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(this.model.get("title"))}&url=${encodeURIComponent(this.model.get("fullUrl"))}`,"_blank")},shareOnGoogleClassroom:function(e){e.preventDefault();var t=encodeURIComponent(this.model.get("fullUrl"));window.open(`https://classroom.google.com/share?url=${t}`,"_blank")},setupSyntaxHighlighting:function(){var e=[];$("pre").each((function(t,n){if($(n).attr("data-src")&&""!=$(n).attr("data-src")){var i=$.ajax({url:$(n).attr("data-src"),type:"GET",success:function(e){$(n).append($("<code></code>").text(e))}});e.push(i)}})),e.length>0&&($("head").append('<link rel="stylesheet" href="'+Ibles.staticUrl("css/prism.css")+'" type="text/css" />'),$.when.apply($,e).always((function(){sessionReady([Ibles.staticUrl("js/libs/prism.js")],(function(){Prism.highlightAll(!0)}))})))},setUpCategoryTracking:function(){var e={},t={},n=this.model.get("category"),i=this.model.get("channel");if(_.isUndefined(Ibles.getCookie("categoryTimer"))){var s=dayjs().add(30,"m"),o=Ibles.reverseUrls.ibleUrl(this.model.get("urlString"));Ibles.setCookie("categoryTimer",this.model.get("id"),{path:o,expires:s.toDate()});try{_.isUndefined(localStorage.ibleCategories)||(e=JSON.parse(localStorage.ibleCategories)),_.isUndefined(e[n])?e[n]=1:e[n]=e[n]+1,localStorage.ibleCategories=JSON.stringify(e),_.isUndefined(i)||(_.isUndefined(localStorage.ibleChannels)||(t=JSON.parse(localStorage.ibleChannels)),_.isUndefined(t[i])?t[i]=1:t[i]=t[i]+1,localStorage.ibleChannels=JSON.stringify(t))}catch(e){try{localStorage.clear()}catch(e){}}}},setupAdminPanel:function(){if(!Ibles.isMobile()&&this.model.isEditableByCurrentUser()){var e=this,t=$("#admin-container");t.length&&Ibles.loadJsBundle("ible_admin_js",(function(){e.adminPanel=new Ibles.views.Admin({el:t,model:e.model,collapsible:!0})}))}}}),Ibles.package("Ibles.views"),Ibles.views.InstructableView=Ibles.views.BaseInstructableView.fullExtend({events:{"click .license-btn":"showLicense","click .finalized-contests, .contest-entry, .view-btn":"viewContest","click .step-tip":"showTipPoster","click .step-question":"showQuestionPoster","click .step-comment":"showCommentPoster","click .view-comments-btn, .comment-count":"scrollToComments","click .imadeit-btn":"scrollToIMadeIts","click .promo-link":"adClick"},initialize:function(e){this._super(e),this.setupStickyHeader(),this.setupImadeIts(),this.setupComments(),this.listenTo(this.model,"userDataSynced",this.afterUserDataSynced)},afterUserDataSynced:function(){},setupStickyHeader:function(){this.stickyHeader=new Ibles.views.StickyHeader({el:this.$el,model:this.model})},setupImadeIts:function(){this.IMadeItsManager=new Ibles.views.ImadeItsManager({el:"#imadeits",model:this.model})},setupComments:function(){var e=this,t=e.model;t.get("disableComments")||sessionReady((function(){e.commentsManager=new Ibles.views.CommentsManager({el:"#comments",model:t,fetchRatings:!0,additionalCommentContext:function(t){var n=t.get("stepId");return n?e.getStepProps(n):{}}}),e.commentTypeSelector=new Ibles.views.CommentTypeSelector({el:"#discuss",manager:e.commentsManager}).render()}))},showLicense:function(){var e=this.$(".license-btn").data("url");window.open(e,"LICENSE","status=yes,scrollbars=yes,resizable=yes,width=800,height=400")},viewContest:function(e){var t=$(e.target).closest(".contest-entry").find("a").attr("href");window.location=t},getTitleForPhotoset:function(e){var t=$(e).prev(".step-title").text();return t.substring(t.indexOf(":")+1).trim()},getStepId:function(e){return $(e.target).closest(".step").data("stepid")},getStepProps:function(e){var t,n=$('.step[data-stepid="'+e+'"]'),i={};return n.length&&(t=n.find(".step-title").text(),_.extend(i,{stepId:e,stepAnchorId:n.attr("id"),stepIndexLabel:t.substring(0,t.indexOf(":")).trim()})),i},showTipPoster:function(e){this.showStepCommentPoster(e,"tip")},showQuestionPoster:function(e){this.showStepCommentPoster(e,"question")},showCommentPoster:function(e){this.showStepCommentPoster(e,"comment")},showStepCommentPoster:function(e,t){var n=this,i=n.commentTypeSelector;i.renderPoster({designation:t,modelProps:{stepId:$(e.target).closest(".step").data("stepid"),designations:[t]},callback:function(){i.scrollToMe(),n.stickyHeader.hide()}})},scrollToComments:function(){window.location.hash="#discuss"},scrollToIMadeIts:function(e){this.IMadeItsManager.renderPoster(e),window.location.hash="#imadeits"},adClick:function(){Ibles.gaUserEvent("Click",{eventLabel:"AutodeskAds",eventValue:this.model.get("urlString")})}}),Ibles.package("Ibles.views"),Ibles.views.DesktopInstructableView=Ibles.views.InstructableView.fullExtend({events:{"click .view-in-3d-btn":"viewIn3d","click .step-link":"stepLinkClicked"},initialize:function(e){this._super(e),this.setupPhotosets(),this.setupSyntaxHighlighting(),this.showAuthorActions(),this.updateFeaturedBy(),this.updatePublishDate()},afterUserDataSynced:function(){this._super(),this.setupAdminPanel()},setupPhotosets:function(){var e=this;this.model.getPhotosetFiles().done((function(t){var n=e.$(".mediaset");_.each(n,(function(n,i){new Ibles.views.PhotosetView({el:n,model:e.model,fileCollection:t[i],title:e.getTitleForPhotoset(n)})}));var i=Ibles.pageContext.ibleData.suppliesFiles;if(i&&i.length){var s=e.$(".mediaset-supplies");new Ibles.views.PhotosetView({el:s,model:e.model,fileCollection:new Ibles.collections.FileCollection(i.filter((e=>e.image))),title:"Supplies"})}}))},isViewedByAuthor:function(){var e=Ibles.session;return e.authenticated()&&e.get("screenName")===this.model.author.get("screenName")},showAuthorActions:function(){var e=Ibles.session,t=e.authenticated()&&e.isAdmin(),n=this.isViewedByAuthor(),i=!_.isEmpty(this.model.get("collaborators"))&&!_.isEmpty(_.findWhere(this.model.get("collaborators"),{screenName:e.get("screenName")}));(t||n||i)&&this.$(".author-action").removeClass("author-action"),t&&this.$(".admin-action").removeClass("admin-action")},updatePublishDate:function(){if(Ibles.session.authenticated()){var e=dayjs(this.model.get("publishDate")).format("MMMM DD YYYY");this.$(".publish-date").html(e)}},updateFeaturedBy:function(){(Ibles.session.isAdmin()||Ibles.session.isStaff())&&(!0!==this.model.get("featureFlag")||_.isUndefined(this.model.get("featuredBy"))||this.$(".featured-by").html(_.template(Ibles.JST["featured-by"])(this.model.toJSON())))},viewIn3d:function(e){e.preventDefault();var t=$($(e.target).attr("data-embed-html"));t.removeAttr("width"),t.removeAttr("height");var n=$("<div></div>");n.append(t),head.load(Ibles.staticUrl("css/embedModal.css")),Ibles.loadJsBundle("ible_modal_embed_viewer_js",(function(){var t=new Ibles.views.EmbedModalView({model:new Ibles.models.EmbedModel({embedCode:n.html(),fileName:$(e.target).attr("data-embed-filename")})});$("body").append(t.render())}))},stepLinkClicked:function(){this.stickyHeader.hide()}});